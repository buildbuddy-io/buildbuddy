<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="BuildBuddy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="BuildBuddy Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-156160991-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<script id="warmly-script-loader" src="https://opps-widget.getwarmly.com/warmly.js?clientId=ff4d871d33dc25dad62ee98e60065bc0" defer="defer"></script><title data-react-helmet="true">How Bazel 5.0 Makes Your Builds Faster | BuildBuddy</title><meta data-react-helmet="true" property="og:title" content="How Bazel 5.0 Makes Your Builds Faster | BuildBuddy"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:description" content="Highlighting changes in Bazel 5.0 that help BuildBuddy users build even faster!"><meta data-react-helmet="true" property="og:url" content="https://www.buildbuddy.io/blog/how-bazel-5-0-makes-your-builds-faster"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" name="description" content="BuildBuddy provides enterprise features for Bazel — the open source build system that allows you to build and test software 10x faster."><meta data-react-helmet="true" name="og:description" content="BuildBuddy provides enterprise features for Bazel — the open source build system that allows you to build and test software 10x faster."><meta data-react-helmet="true" property="og:image" content="https://www.buildbuddy.io/img/bazel_5_0_faster.png"><meta data-react-helmet="true" name="twitter:image" content="https://www.buildbuddy.io/img/bazel_5_0_faster.png"><link data-react-helmet="true" rel="icon" href="/img/favicon_black.svg"><link data-react-helmet="true" rel="canonical" href="https://www.buildbuddy.io/blog/how-bazel-5-0-makes-your-builds-faster"><link data-react-helmet="true" rel="alternate" href="https://www.buildbuddy.io/blog/how-bazel-5-0-makes-your-builds-faster" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://www.buildbuddy.io/blog/how-bazel-5-0-makes-your-builds-faster" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e09f6429.css">
<link rel="preload" href="/assets/js/runtime~main.74b6de8e.js" as="script">
<link rel="preload" href="/assets/js/main.0c9f98e2.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="BuildBuddy Logo" class="themedImage_1VuW themedImage--light_3UqQ" height="32px" width="191px"><img src="/img/logo_white.svg" alt="BuildBuddy Logo" class="themedImage_1VuW themedImage--dark_hz6m" height="32px" width="191px"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/features">Features</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/ui">Build &amp; Test UI</a></li><li><a class="dropdown__link" href="/remote-execution">Remote Execution</a></li><li><a class="dropdown__link" href="/remote-cache">Remote Cache</a></li><li><a class="dropdown__link" href="/workflows">Workflows</a></li><li><a class="dropdown__link" href="/cli">BuildBuddy CLI</a></li><li><a class="dropdown__link" href="/plugins">Plugin Library</a></li></ul></div><a class="navbar__item navbar__link" target="_self" href="/pricing">Pricing</a><a href="https://github.com/buildbuddy-io/buildbuddy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a class="navbar__item navbar__link" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/introduction/">Docs</a><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link sign-up"><span>Get Started<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--1"></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_3kJS">How Bazel 5.0 Makes Your Builds Faster</h1><div class="margin-vert--md"><div class="heading_1SDJ"><div class="headingPhoto_1iKi"><a href="https://brentleyjones.com" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo undefined"><img src="https://avatars.githubusercontent.com/u/158658?v=4" alt="Brentley Jones"></a></div><div><span><a href="https://brentleyjones.com" target="_blank" rel="noopener noreferrer" class="authorName_3Kcr">Brentley Jones</a>, <span>Developer Evangelist @ BuildBuddy</span></span><time datetime="2022-01-25T12:00:00.000Z" class="blogPostDate_247f"><br>January 25, 2022<!-- --> <!-- --> · <!-- -->4 min read</time></div></div></div></header><div class="markdown"><p>In our <a href="/blog/whats-new-in-bazel-5-0">last post</a>,
we summarized the changes that were in the Bazel 5.0 release.
There were a lot of changes though,
so it can be hard to determine which ones are impactful to you and why.</p><p>Don&#x27;t worry, we&#x27;ve got your back.
In this post we highlight the changes that help BuildBuddy users build even faster!</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="build-event-service-bes-improvements">Build Event Service (BES) improvements<a class="hash-link" href="#build-event-service-bes-improvements" title="Direct link to heading">​</a></h2><p>Bazel 5.0 includes many changes that make uploading BES events and artifacts to the BuildBuddy UI more reliable and performant.</p><p>Before Bazel 5.0,
if you wanted to upload a timing profile to BuildBuddy,
you had to be fine with Bazel uploading all outputs referenced in the BEP,
even if they were set to not be cached
(e.g. the <code>--noremote_upload_local_results</code> flag or the <code>no-remote-cache</code> tag).
Now you can set the <code>--incompatible_remote_build_event_upload_respect_no_cache</code> flag,
which causes Bazel to respect your wishes in regards to output caching.</p><p>Also,
if you&#x27;ve had <a href="https://github.com/bazelbuild/bazel/issues/11392" target="_blank" rel="noopener noreferrer">warnings</a> or <a href="https://github.com/bazelbuild/bazel/issues/11408" target="_blank" rel="noopener noreferrer">crashes</a> when using <code>--bes_upload_mode=fully_async</code> in the past,
those should now be fixed as well.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="deduplicated-cache-calls-and-uploads">Deduplicated cache calls and uploads<a class="hash-link" href="#deduplicated-cache-calls-and-uploads" title="Direct link to heading">​</a></h2><p>Before Bazel 5.0,
when using Remote Build Execution (RBE),
Bazel would ask the cache which blobs it needed to upload for every input to an action that was going to be executed remotely.<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup>
It did this even if it had previously uploaded a specific input for a previous action.
Similarly,
if two actions with similar inputs were executed concurrently,
then Bazel didn&#x27;t deduplicate the input existence checking or uploading.</p><p>For projects with a large number of shared inputs,
which is common in C-family programming languages and Node.js,
this can cause a significant amount of network traffic,
resulting in long build times on low-bandwidth, high-latency connections.</p><p>On the output side of things,
if multiple actions produced the same output,
then Bazel would upload the output multiple times.
If these outputs were large,
then this caused significant network overhead.</p><p>Bazel 5.0 addresses these issues.
If you have a project that shares a lot of inputs between actions
(e.g. C, C++, Objective-C, and Node.js),
and you use BuildBuddy&#x27;s Remote Execution,
then Bazel 5.0 should improve your build times.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="faster-action-cache-checking">Faster action cache checking<a class="hash-link" href="#faster-action-cache-checking" title="Direct link to heading">​</a></h2><p>In a similar vein as the above mentioned issues,
Bazel can be unnecessarily slow when checking if an action with a large number of inputs is cached.
This is because Bazel needs to build a <a href="https://en.wikipedia.org/wiki/Merkle_tree" target="_blank" rel="noopener noreferrer">Merkle tree</a> from an action&#x27;s inputs,
which can be expensive if there are many.</p><p>Starting in Bazel 5.0,
you can use the <code>--experimental_remote_merkle_tree_cache</code> and <code>--experimental_remote_merkle_tree_cache_size</code> flags to cache the nodes of these merkle trees.
If you have a project that shares a lot of it&#x27;s inputs between actions
(e.g. C, C++, Objective-C, and Node.js),
and you use BuildBuddy&#x27;s Remote Cache or Remote Execution,
then these flags should improve your build times.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="asynchronous-cache-uploading">Asynchronous cache uploading<a class="hash-link" href="#asynchronous-cache-uploading" title="Direct link to heading">​</a></h2><p>When an action is run locally,
and Bazel uploads the action&#x27;s outputs to a remote build cache,
it waits for that upload to complete before it executes dependent actions.
This is needed for dependent actions that are executed remotely,
but it&#x27;s unnecessary if they are executed locally.
These delays can cause builds that use BuildBuddy&#x27;s Remote Cache to sometimes be slower than if they didn&#x27;t use the cache.</p><p>Starting in Bazel 5.0,
you can use the <code>--experimental_remote_cache_async</code> flag to have Bazel perform these uploads asynchronously.
Uploads still need to complete before a build finishes,
but now Bazel can speed ahead with local execution regardless of upload speed.
Network utilization is also improved,
as uploads can queue up quicker.
If you have a project that uploads to BuildBuddy&#x27;s Remote Cache,
then this flag should improve your build times.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="compressed-uploads-and-downloads">Compressed uploads and downloads<a class="hash-link" href="#compressed-uploads-and-downloads" title="Direct link to heading">​</a></h2><p>Bazel 5.0 added the <code>--experimental_remote_cache_compression</code> flag,
which causes Bazel to compresses and decompress artifact uploads and downloads with the <a href="https://en.wikipedia.org/wiki/Zstandard" target="_blank" rel="noopener noreferrer">zstd algorithm</a>.
In our testing this reduces the average number of bytes transferred by 60-70%.</p><p>There is some overhead involved in this,
both on the Bazel side and the cache side,
so it won&#x27;t make every build for every project faster.<sup id="fnref-2"><a href="#fn-2" class="footnote-ref">2</a></sup>
That said,
if network bandwidth is a bottleneck in your build times,
this flag could make those builds significantly faster.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="and-more">And more...<a class="hash-link" href="#and-more" title="Direct link to heading">​</a></h2><p>Bazel 5.0 includes many additional changes that improve it&#x27;s reliability and performance.
To dig a little deeper,
be sure to check out our <a href="/blog/whats-new-in-bazel-5-0">What&#x27;s New in Bazel 5.0</a> post.</p><div class="footnotes"><hr><ol><li id="fn-1">Specifically,
Bazel would make a <code>FindMissingBlobs</code> that contained every input for an action,
every time.
Now Bazel will only include the unique inputs it hasn&#x27;t already uploaded before.<a href="#fnref-1" class="footnote-backref">↩</a></li><li id="fn-2">Eventually we might store artifacts in their compressed state,
removing most overhead on the cache side.<a href="#fnref-2" class="footnote-backref">↩</a></li></ol></div></div><footer class="row margin-vert--lg"><div class="tags_2aeM"><strong>Tags:</strong><a class="tag_3Sf8" href="/blog/tags/bazel">bazel</a></div></footer></article><div><a href="https://github.com/buildbuddy-io/buildbuddy/edit/master/website/blog/how-bazel-5-0-makes-your-builds-faster.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/bazels-remote-caching-and-remote-execution-explained"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« <!-- -->Bazel&#x27;s Remote Caching and Remote Execution Explained</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/whats-new-in-bazel-5-0"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">What&#x27;s New in Bazel 5.0<!-- --> »</div></a></div></nav></div></main><div class="col col--3"><div class="blog-sidebar"><div class="sidebar_2tcx thin-scrollbar"><h3 class="sidebarItemTitle_1XYP">Recent posts</h3><ul class="sidebarItemList_3OT0"><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/welcoming-grace-chuang">Welcoming Grace Chuang</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/donating-rules_xcodeproj-to-the-mobile-native-foundation">Donating rules_xcodeproj to the Mobile Native Foundation</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/multiple-xcode-configurations-with-rules_xcodeproj-1-3">Multiple Xcode Configurations with rules_xcodeproj 1.3</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/introducing-rules_xcodeproj-1-0">Introducing rules_xcodeproj 1.0</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/welcoming-son-luong-ngoc">Welcoming Son Luong Ngoc</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/whats-new-in-bazel-6-0">What&#x27;s New in Bazel 6.0</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/welcoming-jim-hollenbach">Welcoming Jim Hollenbach</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/bazelcon">Bazelcon 2022 Recap</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/clickhouse-build-trends">How We Use ClickHouse to Analyze Trends Across Millions of Builds</a></li><li class="sidebarItem_ic0g"><a class="sidebarItemLink_3PPN" href="/blog/welcoming-iain-macdonald">Welcoming Iain Macdonald</a></li></ul></div></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items"><li class="footer__item"><a href="/"><img alt="BuildBuddy Logo" src="/img/logo_white.svg" width="281px" height="32px" class="footer-logo"></a></li></ul></div><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_self" href="/ui">Build &amp; Test UI</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/remote-execution">Remote Execution</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/remote-cache">Remote Cache</a></li><li class="footer__item"><a href="https://app.buildbuddy.io" target="_self" rel="noopener noreferrer" class="footer__link-item"><span>Get Started<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/introduction/">Documentation</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/pricing">Pricing</a></li><li class="footer__item"><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="footer__link-item"><span>Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/privacy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/terms">Terms of Service</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_self" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/buildbuddy-io/buildbuddy/issues/new" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Report an Issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/contact">Contact Us</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/team">Team</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/careers">Careers</a></li></ul></div><div class="col footer__col"><div class="footer__title">Security</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_self" href="/security">Security Overview</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/security-updates">Security Updates</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/security-vulnerability-report">Report a Vulnerability</a></li></ul></div><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items"><li class="footer__item"><a href="http://slack.buildbuddy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/buildbuddy_io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="http://linkedin.com/company/buildbuddy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/buildbuddy-io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2023 Iteration, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.74b6de8e.js"></script>
<script src="/assets/js/main.0c9f98e2.js"></script>
</body>
</html>