<!doctype html>
<html lang="en" dir="ltr" class="plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Troubleshooting Bazel with Git Bisect | BuildBuddy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.buildbuddy.io/blog/bisect-bazel"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="og:description" content="BuildBuddy provides enterprise features for Bazel — the open source build system that allows you to build and test software 10x faster."><meta data-rh="true" property="og:title" content="Troubleshooting Bazel with Git Bisect | BuildBuddy"><meta data-rh="true" name="description" content="A guide to using Git bisect to troubleshoot Bazel issues"><meta data-rh="true" property="og:description" content="A guide to using Git bisect to troubleshoot Bazel issues"><meta data-rh="true" property="og:image" content="https://www.buildbuddy.io/img/blog/troubleshooting.png"><meta data-rh="true" name="twitter:image" content="https://www.buildbuddy.io/img/blog/troubleshooting.png"><link data-rh="true" rel="icon" href="/img/favicon_black.svg"><link data-rh="true" rel="canonical" href="https://www.buildbuddy.io/blog/bisect-bazel"><link data-rh="true" rel="alternate" href="https://www.buildbuddy.io/blog/bisect-bazel" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.buildbuddy.io/blog/bisect-bazel" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="BuildBuddy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="BuildBuddy Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-156160991-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.98c35fc4.css">
<script src="/assets/js/runtime~main.b827ada5.js" defer="defer"></script>
<script src="/assets/js/main.7de126b0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="BuildBuddy Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32px" width="191px"><img src="/img/logo_white.svg" alt="BuildBuddy Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32px" width="191px"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/features">Features</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/ui">Build &amp; Test UI</a></li><li><a class="dropdown__link" href="/remote-execution">Remote Execution</a></li><li><a class="dropdown__link" href="/remote-cache">Remote Cache</a></li><li><a class="dropdown__link" href="/workflows">Workflows</a></li><li><a class="dropdown__link" href="/cli">BuildBuddy CLI</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a href="https://github.com/buildbuddy-io/buildbuddy" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="http://community.buildbuddy.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Community</a></li><li><a class="dropdown__link" href="/security">Security</a></li><li><a class="dropdown__link" href="/plugins">Plugins</a></li><li><a class="dropdown__link" href="/team">Team</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/introduction/">Docs</a><a class="navbar__item navbar__link" target="_self" href="/blog/">Blog</a><a class="navbar__item navbar__link" target="_self" href="/pricing">Pricing</a></div><div class="navbar__items navbar__items--right"><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Login</a><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link sign-up">Sign up</a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 blog-wrapper"><div class="blog-container margin-vert--lg"><div class="row"><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_TjLu">Troubleshooting Bazel with Git Bisect</h1><div class="margin-vert--md"><div class="heading_cWLF"><div class="headingPhoto_YUAj"><a href="https://avatars.githubusercontent.com/u/26684313?v=4" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo undefined"><img src="https://avatars.githubusercontent.com/u/26684313?v=4" alt="[object Object]"></a></div><div><span><a href="https://github.com/sluongng/" target="_blank" rel="noopener noreferrer" class="authorName_Xags">Son Luong Ngoc</a>, <span>Solution Engineer @ BuildBuddy</span></span><time datetime="2025-02-18T12:00:00.000Z" class="blogPostDate_NeIP"><br>February 18, 2025<!-- --> <!-- --> · <!-- -->13 min read</time></div></div></div></header><div class="markdown"><p>Upgrading Bazel and the related dependencies can sometimes lead to unexpected issues.
These issues can range from build failures to runtime errors, and generally, they can be hard to troubleshoot.</p>
<p>So today, we will discuss how to narrow down the root cause of build failures after a dependency upgrade using <code>git bisect</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-failed-after-upgrading-bazel">Build failed after upgrading Bazel<a href="#build-failed-after-upgrading-bazel" class="hash-link" aria-label="Direct link to Build failed after upgrading Bazel" title="Direct link to Build failed after upgrading Bazel">​</a></h2>
<p>If you are like me, you would enjoy having the latest and greatest tools in your project.
And the tool I use the most is Bazel, so as the recent <code>8.1.0</code> release came out, I decided to upgrade our BuildBuddy repository to use it.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;8.1.0&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> .bazelversion</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ bazel </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote-minimal //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">ERROR: /root/workspace/output-base/external/bazel_tools/tools/build_defs/repo/http.bzl:137:45: An error occurred during the fetch of repository </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;rules_cc+&#x27;</span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">   Traceback </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">most recent call last</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        File </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;/root/workspace/output-base/external/bazel_tools/tools/build_defs/repo/http.bzl&quot;</span><span class="token plain">, line </span><span class="token number" style="color:rgb(181, 206, 168)">137</span><span class="token plain">, </span><span class="token function" style="color:rgb(220, 220, 170)">column</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">45</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> _http_archive_impl</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">                download_info </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> ctx.download_and_extract</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Error </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> download_and_extract: com.google.devtools.build.lib.remote.common.CacheNotFoundException: Missing digest: abc605dd850f813bb37004b77db20106a19311a96b2da1c92b789da529d28fe1/178823</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Whoops! It seems like the build failed after upgrading Bazel to <code>8.1.0</code>.
Flipping back to <code>8.0.1</code> made the problem go away, which means the issue was introduced in Bazel <code>8.1.0</code>.</p>
<p>What should we do next?</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="auto-bisect-with-bazelisk">Auto-bisect with bazelisk<a href="#auto-bisect-with-bazelisk" class="hash-link" aria-label="Direct link to Auto-bisect with bazelisk" title="Direct link to Auto-bisect with bazelisk">​</a></h4>
<p>Luckily, the Bazel team has provided us with a magic flag inside <code>bazelisk</code> that can help us with this.</p>
<p><a href="https://github.com/bazelbuild/bazelisk?tab=readme-ov-file#--bisect" target="_blank" rel="noopener noreferrer">--bisect</a> flag automatically lists the commits between the two Bazel releases and helps us bisect them.
It works like this:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token builtin class-name" style="color:rgb(78, 201, 176)">alias</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">bazel</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">bazelisk</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Usage:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#   bazelisk --bisect=&lt;good commit hash&gt;..&lt;bad commit hash&gt; test //foo:bar_test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">BAZELISK_CLEAN</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> bazelisk </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--bisect</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">8.0</span><span class="token plain">.1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0 </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote-minimal //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Explanation</strong>: The last-known good release for us was <code>8.0.1</code>, and the bad release was <code>8.1.0</code>. Bazelisk will grab the list of commits between 2 versions from the Github API and start a bisect. For each bisect commit, it will grab a pre-built Bazel binary of that version from a Google Cloud Storage bucket and run the test command accordingly. The <code>.bazelversion</code> file will be ignored in these runs.</p>
<p>Because the issue was related to external dependencies download, we set <code>BAZELISK_CLEAN=1</code> for the whole Bazelisk bisect process.
This will add <code>bazel clean --expunge</code> in between each test run, effectively cleaning Bazel&#x27;s output base and shutting down the Bazel JVM process, to make sure we reproduce the issue in a mint environment.
You can check out other environment variables that Bazelisk supports <a href="https://github.com/bazelbuild/bazelisk/blob/740e1b91b5b2e86730b6bb12aaf211fc19f388a5/README.md?plain=1#L162" target="_blank" rel="noopener noreferrer">here</a></p>
<p>Since we know that the issue was caused by the external download of <code>@rules_cc</code>, we can narrow down the test command to a <code>bazel query</code> that would still trigger the same download. This should help speed up each bisect run and reduce the chance of flakiness.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">BAZELISK_CLEAN</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> bazelisk </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--bisect</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">8.0</span><span class="token plain">.1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0 query </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote-minimal @rules_cc//:all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And here is the result:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">--- Getting the list of commits between </span><span class="token number" style="color:rgb(181, 206, 168)">8.0</span><span class="token plain">.1 and </span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Found </span><span class="token number" style="color:rgb(181, 206, 168)">95</span><span class="token plain"> commits between </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">24cba660a7231786405ac40335c2e7e5bd4d6859, </span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">--- Verifying </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> the given good Bazel commit </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">24cba660a7231786405ac40335c2e7e5bd4d6859</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> is actually good</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">--- Start bisecting</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">--- Testing with Bazel built at c5cf63199b3964b4a188da73a6c24599468131e9, </span><span class="token number" style="color:rgb(181, 206, 168)">95</span><span class="token plain"> commits remaining</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">--- Succeeded at c5cf63199b3964b4a188da73a6c24599468131e9</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">--- Testing with Bazel built at 040769767613287a0f1b5ceed41b9d7729126983, </span><span class="token number" style="color:rgb(181, 206, 168)">47</span><span class="token plain"> commits remaining</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain">/02/18 </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain">:56:29 Using unreleased version at commit 040769767613287a0f1b5ceed41b9d7729126983</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain">/02/18 </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain">:56:29 Downloading https://storage.googleapis.com/bazel-builds/artifacts/macos_arm64/040769767613287a0f1b5ceed41b9d7729126983/bazel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain">/02/18 </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain">:56:29 Skipping basic authentication </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> storage.googleapis.com because no credentials found </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> /Users/sluongng/.netrc</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain">/02/18 </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain">:56:29 could not run Bazel: could not download Bazel: failed to download bazel: failed to download bazel: HTTP GET https://storage.googleapis.com/bazel-builds/artifacts/macos_arm64/040769767613287a0f1b5ceed41b9d7729126983/bazel failed with error </span><span class="token number" style="color:rgb(181, 206, 168)">404</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here, Bazelisk was able to identify <code>8.0.1</code> to be <code>24cba660a</code> and verified that it was indeed a good commit. It then started bisecting the commits between <code>24cba660a</code> and <code>8.1.0</code>. The first bisect commit <code>c5cf63199b</code> was good. However, the second bisect commit <code>0407697676</code> failed to download the Bazel binary from the Google Cloud Storage (GCS) bucket. This is a different failure than the original issue we are investigating, so how do we proceed?</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="manual-bisect-with-git-bisect">Manual bisect with git-bisect<a href="#manual-bisect-with-git-bisect" class="hash-link" aria-label="Direct link to Manual bisect with git-bisect" title="Direct link to Manual bisect with git-bisect">​</a></h4>
<p>If Bazelisk had a flag to help us mark a few known commits as &quot;SKIP&quot;, it would have been perfect here, but unfortunately, it doesn&#x27;t. But I know for a fact that <code>git bisect</code> does have this feature, so let&#x27;s switch to manual bisecting.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token comment" style="color:rgb(106, 153, 85)"># My personal working directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/bazelbuild/</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Clone the Bazel repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> clone https://github.com/bazelbuild/bazel.git</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> bazel</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Start bisecting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> bisect start --no-checkout --first-parent </span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0 </span><span class="token number" style="color:rgb(181, 206, 168)">8.0</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">47</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">6</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">8afe16e0396be93cc5d9bc2108aab2e45dfcb2bd</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Fix docs </span><span class="token function" style="color:rgb(220, 220, 170)">link</span><span class="token plain"> rewriting </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> rules_android </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#25018)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that thanks to the pre-built binaries from the GCS bucket managed by the Bazel team, we don&#x27;t need to build Bazel ourselves. Because of this, we can use the <code>--no-checkout</code> flag to speed up the bisect process. When <code>--no-checkout</code> is used, the current bisect commit could be found in <code>.git/BISECT_HEAD</code> file.
<code>--first-parent</code> forces the bisect to only follow the first parent of the commit, which is usually all the merge commits in the <code>master/main</code> branch of each repo.
Thankfully, the <code>bazel.git</code> repo history is very linear so <code>--first-parent</code> is not really needed here, but I will keep the flag in to help the readers (including my future self) copy pasting easier.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">cat</span><span class="token plain"> .git/BISECT_HEAD</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">8afe16e0396be93cc5d9bc2108aab2e45dfcb2bd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So how do we tell Bazelisk to use a pre-built binary from the GCS bucket that belongs to this commit? Luckily, we can set the environment variable <code>USE_BAZEL_VERSION</code> for this exact reason.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">USE_BAZEL_VERSION</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">7.1</span><span class="token plain">.0 bazel version</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">version</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bazelisk version: </span><span class="token number" style="color:rgb(181, 206, 168)">1.25</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Extracting Bazel installation</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Build label: </span><span class="token number" style="color:rgb(181, 206, 168)">7.1</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Build target: @@//src/main/java/com/google/devtools/build/lib/bazel:BazelServer</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Build time: Mon Mar </span><span class="token number" style="color:rgb(181, 206, 168)">11</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">:55:51 </span><span class="token number" style="color:rgb(181, 206, 168)">2024</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1710179751</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Build timestamp: </span><span class="token number" style="color:rgb(181, 206, 168)">1710179751</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Build timestamp as int: </span><span class="token number" style="color:rgb(181, 206, 168)">1710179751</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With this, we can manually alternate between the 2 directories <code>~/work/bazelbuild/bazel</code> and <code>~/work/buildbuddy-io/buildbuddy</code> to run the test command and mark the commit as good or bad.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token comment" style="color:rgb(106, 153, 85)"># Copy the new bisect commit to the clipboard</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">USE_BAZEL_VERSION</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">cat</span><span class="token variable" style="color:rgb(156, 220, 254)"> .git/BISECT_HEAD</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Verify the commit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/buildbuddy-io/buildbuddy</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ bazel </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">. query </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/bazelbuild/bazel</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># $ git bisect good</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># $ git bisect bad</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># $ git bisect skip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Repeat</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, that would not make for a really good blog post.
So let&#x27;s be a bit more fancy and create a script to help us automate this bisect process using <code>git bisect run</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">cat</span><span class="token plain"> test-buildbuddy.sh</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">USE_BAZEL_VERSION</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;8.0.1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># export USE_BAZEL_VERSION=$(cat .git/BISECT_HEAD)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(220, 220, 170)">cleanup</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/buildbuddy-io/buildbuddy</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    bazel clean </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--expunge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">trap</span><span class="token plain"> cleanup EXIT</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/buildbuddy-io/buildbuddy</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">STDERROUT</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable" style="color:rgb(156, 220, 254)">bazel </span><span class="token variable operator file-descriptor important" style="color:rgb(212, 212, 212)">2</span><span class="token variable operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token variable file-descriptor important" style="color:rgb(156, 220, 254)">&amp;1</span><span class="token variable" style="color:rgb(156, 220, 254)"> query </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">--repository_cache</span><span class="token variable operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable string" style="color:rgb(206, 145, 120)">&#x27;&#x27;</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token variable operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">remote-minimal @bazel_features//:all</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">BAZEL_EXIT_CODE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># If stderr contains &#x27;could not download Bazel&#x27; then return with code 125</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># to skip the current commit during bisect.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$BAZEL_EXIT_CODE</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-ne</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$STDERROUT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> *</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;could not download Bazel&quot;</span><span class="token plain">* </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Bazel download failed. Skipping commit </span><span class="token string variable" style="color:rgb(156, 220, 254)">$USE_BAZEL_VERSION</span><span class="token string" style="color:rgb(206, 145, 120)">.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">125</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$BAZEL_EXIT_CODE</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-ne</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Bazel query failed with exit code </span><span class="token string variable" style="color:rgb(156, 220, 254)">$BAZEL_EXIT_CODE</span><span class="token string" style="color:rgb(206, 145, 120)">.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token keyword" style="color:rgb(86, 156, 214)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">exit</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$BAZEL_EXIT_CODE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Explanation</strong>:</p>
<p>First, we want to export the <code>USE_BAZEL_VERSION</code> environment variable to the commit hash that we are currently bisecting. This will tell Bazelisk to use the pre-built binary from the GCS bucket that belongs to this commit. However, we won&#x27;t use BISECT_HEAD just yet since we want to verify that this script works first. Knowing that <code>8.0.1</code> was the last known good commit, we can set the <code>USE_BAZEL_VERSION</code> to do a sanity check.</p>
<p>Next, since we are not using Bazelisk bisect feature, the automatic cleanup feature of <code>BAZELISK_CLEAN</code> won&#x27;t work.
Instead, we will manually clean the workspace after each test run with <code>bazel clean --expunge</code> to achieve similar result.</p>
<p>After that, we want to make sure that we handle the download issue as some commits might be missing from the GCS bucket.
<code>git bisect run</code> allows us to skip the current commit by returning with an exit code of <code>125</code>.</p>
<blockquote>
<p>The special exit code 125 should be used when the current source code cannot be tested.
If the script exits with this code, the current revision will be skipped</p>
</blockquote>
<p>So we check if the Bazel query failed with the error message <code>could not download Bazel</code> and return with the exit code <code>125</code> to skip the current commit.
Otherwise, we return with the exit code of the Bazel query command.</p>
<p>Now let&#x27;s verify that our script works on <code>8.0.1</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ ./test-buildbuddy.sh</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Starting </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">local</span><span class="token plain"> Bazel server </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">no_version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> and connecting to it</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">@rules_cc//:empty_lib</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">@rules_cc//:link_extra_lib</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">@rules_cc//:link_extra_libs</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Loading: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> packages loaded</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now let&#x27;s edit the script to use the <code>USE_BAZEL_VERSION</code> from the <code>BISECT_HEAD</code> file for the bisect run and run the bisect:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">cat</span><span class="token plain"> test-buildbuddy.sh</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># export USE_BAZEL_VERSION=&#x27;8.0.1&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">USE_BAZEL_VERSION</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">cat</span><span class="token variable" style="color:rgb(156, 220, 254)"> .git/BISECT_HEAD</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> bisect run ./test-buildbuddy.sh</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./run.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">11e85a4dc73f93ef25809e7d5f0409aaca7d42f1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Respect comprehension variable shadowing </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> Starlark debugger output </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#25139)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./run.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bazel download failed. Skipping commit 11e85a4dc73f93ef25809e7d5f0409aaca7d42f1.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain">/02/18 </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token plain">:18:12 Using unreleased version at commit 11e85a4dc73f93ef25809e7d5f0409aaca7d42f1</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain">/02/18 </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token plain">:18:12 Downloading https://storage.googleapis.com/bazel-builds/artifacts/macos_arm64/11e85a4dc73f93ef25809e7d5f0409aaca7d42f1/bazel</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain">/02/18 </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token plain">:18:12 Skipping basic authentication </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> storage.googleapis.com because no credentials found </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> /Users/sluongng/.netrc</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain">/02/18 </span><span class="token number" style="color:rgb(181, 206, 168)">13</span><span class="token plain">:18:12 could not download Bazel: failed to download bazel: failed to download bazel: HTTP GET https://storage.googleapis.com/bazel-builds/artifacts/macos_arm64/11e85a4dc73f93ef25809e7d5f0409aaca7d42f1/bazel failed with error </span><span class="token number" style="color:rgb(181, 206, 168)">404</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">12a3fc001b6629b52f5b24dce6018884222a0608</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> See and use </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> than </span><span class="token number" style="color:rgb(181, 206, 168)">64</span><span class="token plain"> CPUs on Windows </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#25140)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./run.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">af6307bc6832d66cce772c5170961b4ff4521e48</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Configure </span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">--run_under</span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token plain"> target </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> the </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">exec</span><span class="token plain"> platform </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#25184)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./run.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">14219c4698e112a03ebe62eed7cb324f625f13c8</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Use digest </span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> matching the checksum </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> gRPC remote downloader </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#25225)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./run.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bazel query failed with </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">exit</span><span class="token plain"> code </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">5f3a083d5649715dc0bed811ef41f53b91539d1d</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Update to use coverage_output_generator-v2.8 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#25202)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./run.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> revision left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">a40a0cd9947dd73ec07f2394d108eb7e98745161</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Add version selector buttons to repo rule docs </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#25211)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./run.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">aa4531d5a2116f85b80a753c53528032ed3cda71</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Don</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;t suggest updates to private repo rule attributes (#25213)</span><br></span><span class="token-line" style="color:#fff"><span class="token string" style="color:rgb(206, 145, 120)">running &#x27;</span><span class="token plain">./run.sh&#x27;</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">14219c4698e112a03ebe62eed7cb324f625f13c8 is the first bad commit</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">commit 14219c4698e112a03ebe62eed7cb324f625f13c8</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Author: bazel.build machine account </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ci.bazel@gmail.com</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Date:   Fri Feb </span><span class="token number" style="color:rgb(181, 206, 168)">7</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">12</span><span class="token plain">:07:48 </span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain"> +0100</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token number" style="color:rgb(181, 206, 168)">8.1</span><span class="token plain">.0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Use digest </span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> matching the checksum </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> gRPC remote downloader </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#25225)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    Fixes https://bazelbuild.slack.com/archives/CA31HN1T3/p1738763759125489</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    Closes </span><span class="token comment" style="color:rgb(106, 153, 85)">#25206.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    PiperOrigin-RevId: </span><span class="token number" style="color:rgb(181, 206, 168)">724267755</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    Change-Id: Ia23bdae310231bd0ee5763311b948f3465aa8ed0</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    Commit</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    https://github.com/bazelbuild/bazel/commit/ef45e02bfb4af1124bb9ad1ef94f36c70c82ce48</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    Co-authored-by: Fabian Meumertzheim </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">fabian@meumertzhe.im</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">./remote/downloader/GrpcRemoteDownloader.java    </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain"> ++++++++++++++--------</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">./downloader/GrpcRemoteDownloaderTest.java       </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">23</span><span class="token plain"> +++++++++++++---------</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> files changed, </span><span class="token number" style="color:rgb(181, 206, 168)">29</span><span class="token plain"> insertions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">+</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">, </span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain"> deletions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">bisect found first bad commit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And voilà! We have found the commit that introduced the issue.
It was <code>14219c4698e112a03ebe62eed7cb324f625f13c8</code>, which was introduced in Bazel <code>8.1.0</code>.</p>
<p>We won&#x27;t be diving into the details of this specific issue in this blog post,
but if you are interested, you can read more about it via <a href="https://github.com/bazelbuild/bazel/pull/25320" target="_blank" rel="noopener noreferrer">the revert PR #25320</a>.
We expect this to be fixed in the upcoming Bazel 8.1.1 release.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-failed-after-upgrading-a-dependency">Build failed after upgrading a dependency<a href="#build-failed-after-upgrading-a-dependency" class="hash-link" aria-label="Direct link to Build failed after upgrading a dependency" title="Direct link to Build failed after upgrading a dependency">​</a></h2>
<p>This bisect technique can also be used to troubleshoot issues that arise after upgrading a Bazel dependency.
For example, recently we attempted upgrading <code>@rules_go</code> in our repository from <code>v0.51.0</code> to <code>v0.53.0</code>, and the build failed.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ bazel build server</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">ERROR: /private/var/tmp/_bazel_sluongng/06e573a93bc2d6a9cad4ad41f00b4310/external/bazel_gazelle/internal/go_repository_cache.bzl:30:17: An error occurred during the fetch of repository </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel_gazelle_go_repository_cache&#x27;</span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">   Traceback </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">most recent call last</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">	File </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;/private/var/tmp/_bazel_sluongng/06e573a93bc2d6a9cad4ad41f00b4310/external/bazel_gazelle/internal/go_repository_cache.bzl&quot;</span><span class="token plain">, line </span><span class="token number" style="color:rgb(181, 206, 168)">30</span><span class="token plain">, </span><span class="token function" style="color:rgb(220, 220, 170)">column</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">17</span><span class="token plain">, </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> _go_repository_cache_impl</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">		fail</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;gazelle found more than one suitable Go SDK ({}). Specify which one to use with gazelle_dependencies(go_sdk = &quot;go_sdk&quot;).&#x27;</span><span class="token plain">.format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;, &quot;</span><span class="token plain">.join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">matches</span><span class="token punctuation" style="color:rgb(212, 212, 212)">))</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Error </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> fail: gazelle found </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> than one suitable Go SDK </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">go_host_compatible_sdk_label, go_sdk_darwin_arm64</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">. Specify </span><span class="token function" style="color:rgb(220, 220, 170)">which</span><span class="token plain"> one to use with gazelle_dependencies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">go_sdk </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;go_sdk&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">ERROR: no such package </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@@org_golang_google_grpc//reflection&#x27;</span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"> gazelle found </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> than one suitable Go SDK </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">go_host_compatible_sdk_label, go_sdk_darwin_arm64</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">. Specify </span><span class="token function" style="color:rgb(220, 220, 170)">which</span><span class="token plain"> one to use with gazelle_dependencies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">go_sdk </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;go_sdk&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">ERROR: /Users/sluongng/work/buildbuddy-io/buildbuddy/cli/cmd/sidecar/BUILD:3:11: //cli/cmd/sidecar:sidecar depends on @@org_golang_google_grpc//reflection:reflection </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> repository @@org_golang_google_grpc </span><span class="token function" style="color:rgb(220, 220, 170)">which</span><span class="token plain"> failed to fetch. no such package </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;@@org_golang_google_grpc//reflection&#x27;</span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">:</span><span class="token plain"> gazelle found </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> than one suitable Go SDK </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">go_host_compatible_sdk_label, go_sdk_darwin_arm64</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">. Specify </span><span class="token function" style="color:rgb(220, 220, 170)">which</span><span class="token plain"> one to use with gazelle_dependencies</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">go_sdk </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;go_sdk&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">ERROR: Analysis of target </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;//cli:cli&#x27;</span><span class="token plain"> failed</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> build aborted: Analysis failed</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This time, we can use the same bisect technique to identify the commit that introduced the issue.
To make the <code>git bisect</code> a bit less tedious, let&#x27;s use a local copy of <code>@rules_go</code> instead of the one managed by Bazel.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/bazelbuild</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> clone https://github.com/bazel-contrib/rules_go.git</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> rules_go</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> checkout v0.51.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With this, we can add the following lines to our <code>.bazelrc</code> to tell Bazel to use our local copy instead of the one managed by Bazel.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/buildbuddy-io/buildbuddy</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-n</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> .bazelrc</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">## BZLMOD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">common </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--override_module</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">rules_go</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">/Users/sluongng/work/bazelbuild/rules_go</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">## WORKSPACE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">common </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--override_repository</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">io_bazel_rules_go</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">/Users/sluongng/work/bazelbuild/rules_go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Pro tips:</strong> These flags are really handy, so I would recommend keeping them in your <code>.bazelrc</code> file as comments for future use.</p>
<p>Now we can start the bisect process in the <code>@rules_go</code> repository.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/bazelbuild/rules_go</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">cat</span><span class="token plain"> test-rules-go.sh</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/buildbuddy-io/buildbuddy</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  bazel build server</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">chmod</span><span class="token plain"> +x test-rules-go.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since we are relying on our local copy of <code>@rules_go</code>, we do not need to handle the download issue like the previous script.
We are also not expecting the build to fail because of external factors, so no need for setting <code>BAZELISK_CLEAN</code> or handling our own cleanup.
This also means that we are reusing the same Bazel JVM process for each bisect run, taking advantage of the hot analysis cache to keep our builds blazingly fast.</p>
<p>Now let&#x27;s start the bisect process:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">cd</span><span class="token plain"> ~/work/bazelbuild/rules_go</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> bisect start --first-parent v0.53.0 v0.51.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note here that we do NOT want to use the <code>--no-checkout</code> flag as the working copy of the repo is used for the bisect run and therefore, needs to be updated.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">git</span><span class="token plain"> bisect run ./test-rules-go.sh</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./test-rules-go.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">4f5202adf56521b3048536d04eef12690557fa7c</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Mention </span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token variable" style="color:rgb(156, 220, 254)">dev_dependency</span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token variable" style="color:rgb(156, 220, 254)">go_sdk.host</span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token plain"> error </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#4246)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./test-rules-go.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">66477c1b41b2449c8102f4338d011f07e4df04b6</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Update documentation reference </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#4237)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./test-rules-go.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> revision left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">5eb06119c49b97f16aa79d53cdcd99f95b1000bf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Allow .so files to have </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> extensions </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#4232)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./test-rules-go.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Bisecting: </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> revisions left to </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> after this </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">roughly </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> steps</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">d25e4e75f0ce8e419593a5c633f852ff1c08e292</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> Use same Go SDK as Gazelle </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token variable" style="color:rgb(156, 220, 254)">go_bazel_test</span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#4231)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">running </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;./test-rules-go.sh&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">d25e4e75f0ce8e419593a5c633f852ff1c08e292 is the first bad commit</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">commit d25e4e75f0ce8e419593a5c633f852ff1c08e292</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Author: Fabian Meumertzheim </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">fabian@meumertzhe.im</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Date:   Thu Jan </span><span class="token number" style="color:rgb(181, 206, 168)">16</span><span class="token plain"> 08:13:09 </span><span class="token number" style="color:rgb(181, 206, 168)">2025</span><span class="token plain"> +0100</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    Use same Go SDK as Gazelle </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token variable" style="color:rgb(156, 220, 254)">go_bazel_test</span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token comment" style="color:rgb(106, 153, 85)">#4231)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    **What </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">type</span><span class="token plain"> of PR is this?**</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    Bug fix</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    **What does this PR do? Why is it needed?**</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    **Which issues</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> does this PR fix?**</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    Fixes </span><span class="token comment" style="color:rgb(106, 153, 85)">#4228</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    **Other notes </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> review**</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> MODULE.bazel                       </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">  </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> +-</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> go/private/repositories.bzl        </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">11</span><span class="token plain"> +++++++++++</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> go/tools/bazel_testing/BUILD.bazel </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain">  </span><span class="token number" style="color:rgb(181, 206, 168)">9</span><span class="token plain"> ++++++---</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> files changed, </span><span class="token number" style="color:rgb(181, 206, 168)">18</span><span class="token plain"> insertions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">+</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">, </span><span class="token number" style="color:rgb(181, 206, 168)">4</span><span class="token plain"> deletions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">bisect found first bad commit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And there you have it! The issue was introduced in commit <code>d25e4e75f0ce8e419593a5c633f852ff1c08e292</code> in the <code>@rules_go</code> repository, which was introduced in <code>v0.53.0</code>.
This was also fixed swiftly by Fabian in rules_go&#x27;s <a href="https://github.com/bazel-contrib/rules_go/pull/4264" target="_blank" rel="noopener noreferrer">PR #4264</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Using <code>git bisect</code> to troubleshoot build failures after upgrading Bazel or its dependencies can be a powerful tool.
This helps us narrow down the root cause of the issue to the exact commit that introduced it.</p>
<p>This makes the error much more actionable.
For example, when we were able to identify the issue to be in rules_go@v0.53.0, we were able to upgrade to v0.52.0 instead and reported the fix to the upstream open-source project.
In other cases, we can proceed with the upgrade but with a specific revert of the commit that introduced the issue patched into the external dependencies.</p>
<p>I hope this guide was helpful to you and that you can use it to troubleshoot your external dependency upgrades in the future.</p></div><footer class="row margin-vert--lg"><div class="tags_OHNp"><strong>Tags:</strong><a class="tag_p3At" href="/blog/tags/bazel">bazel</a><a class="tag_p3At" href="/blog/tags/git">git</a><a class="tag_p3At" href="/blog/tags/engineering">engineering</a></div></footer></article><div><a href="https://github.com/buildbuddy-io/buildbuddy/edit/master/website/blog/bisect-bazel.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/unusual-builds-w-bytes"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Unusual Builds with Bytes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/welcoming-vanja-pejovic"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Welcoming Vanja Pejovic</div></a></nav></div></main><div class="col col--1"></div><div class="col col--3"><div class="blog-sidebar"><div class="sidebar_ycyQ thin-scrollbar"><h3 class="sidebarItemTitle_uR5j">Recent posts</h3><ul class="sidebarItemList_TpH3"><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/fast-runners-at-scale">Snapshot, Chunk, Clone: Fast Runners at Scale</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/arm64-support">Remote Builds on linux/arm64 with BuildBuddy</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/action-merging">Action Merging</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/welcoming-tyler-french">Welcoming Tyler French</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/welcoming-dan-stowell">Welcoming Dan Stowell</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/unusual-builds-w-bytes">Unusual Builds with Bytes</a></li><li class="sidebarItem_WWBq"><a aria-current="page" class="sidebarItemLink_Hhz8 sidebarItemLinkActive_OkT7" href="/blog/bisect-bazel">Troubleshooting Bazel with Git Bisect</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/welcoming-vanja-pejovic">Welcoming Vanja Pejovic</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/welcoming-fabian-meumertzheim">Welcoming Fabian Meumertzheim</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/debugging-slow-bazel-builds">Why is my Bazel build so slow?</a></li></ul></div></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="/"><img alt="BuildBuddy Logo" src="/img/logo_white.svg" width="281px" height="32px" class="footer-logo"></a></li></ul></div><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/ui">Build &amp; Test UI</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/remote-execution">Remote Execution</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/remote-cache">Remote Cache</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/workflows">Workflows</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/cli">CLI</a></li><li class="footer__item"><a href="https://app.buildbuddy.io" target="_self" rel="noopener noreferrer" class="footer__link-item">Get Started</a></li><li class="footer__item"><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="footer__link-item">Login</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/introduction/">Docs</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/pricing">Pricing</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/security">Security</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/plugins">Plugins</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/enterprise-api">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/contact">Contact Us</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/team">Team</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/careers">Careers</a></li><li class="footer__item"><a href="https://github.com/buildbuddy-io/buildbuddy/issues/new" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report an Issue</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/privacy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/terms">Terms of Service</a></li></ul></div><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://community.buildbuddy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/buildbuddy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="http://linkedin.com/company/buildbuddy" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://github.com/buildbuddy-io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2026 Iteration, Inc.</div></div></div></footer></div>
</body>
</html>