<!doctype html>
<html lang="en" dir="ltr" class="plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Buck2 Unboxing | BuildBuddy</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.buildbuddy.io/blog/buck2-review"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="og:description" content="BuildBuddy provides enterprise features for Bazel — the open source build system that allows you to build and test software 10x faster."><meta data-rh="true" property="og:title" content="Buck2 Unboxing | BuildBuddy"><meta data-rh="true" name="description" content="A review of Meta&#x27;s new build tool Buck2."><meta data-rh="true" property="og:description" content="A review of Meta&#x27;s new build tool Buck2."><meta data-rh="true" property="og:image" content="https://www.buildbuddy.io/img/blog/buck2-header.png"><meta data-rh="true" name="twitter:image" content="https://www.buildbuddy.io/img/blog/buck2-header.png"><link data-rh="true" rel="icon" href="/img/favicon_black.svg"><link data-rh="true" rel="canonical" href="https://www.buildbuddy.io/blog/buck2-review"><link data-rh="true" rel="alternate" href="https://www.buildbuddy.io/blog/buck2-review" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.buildbuddy.io/blog/buck2-review" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="BuildBuddy RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="BuildBuddy Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-156160991-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.8c29db31.css">
<script src="/assets/js/runtime~main.7897ea97.js" defer="defer"></script>
<script src="/assets/js/main.2b62ad85.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="BuildBuddy Logo" class="themedComponent_mlkZ themedComponent--light_NVdE" height="32px" width="191px"><img src="/img/logo_white.svg" alt="BuildBuddy Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="32px" width="191px"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/features">Features</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/ui">Build &amp; Test UI</a></li><li><a class="dropdown__link" href="/remote-execution">Remote Execution</a></li><li><a class="dropdown__link" href="/remote-cache">Remote Cache</a></li><li><a class="dropdown__link" href="/workflows">Workflows</a></li><li><a class="dropdown__link" href="/cli">BuildBuddy CLI</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/blog">Blog</a></li><li><a href="https://github.com/buildbuddy-io/buildbuddy" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="http://community.buildbuddy.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Community<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a class="dropdown__link" href="/security">Security</a></li><li><a class="dropdown__link" href="/plugins">Plugins</a></li><li><a class="dropdown__link" href="/team">Team</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/introduction/">Docs</a><a class="navbar__item navbar__link" target="_self" href="/pricing">Pricing</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_self" href="/contact">Contact</a><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link sign-up">Sign up<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 blog-wrapper"><div class="blog-container margin-vert--lg"><div class="row"><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_TjLu">Buck2 Unboxing</h1><div class="margin-vert--md"><div class="heading_cWLF"><div class="headingPhoto_YUAj"><a href="https://avatars.githubusercontent.com/u/26684313?v=4" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo undefined"><img src="https://avatars.githubusercontent.com/u/26684313?v=4" alt="[object Object]"></a></div><div><span><a href="https://github.com/sluongng/" target="_blank" rel="noopener noreferrer" class="authorName_Xags">Son Luong Ngoc</a>, <span>Solution Engineer @ BuildBuddy</span></span><time datetime="2023-05-30T12:00:00.000Z" class="blogPostDate_NeIP"><br>May 30, 2023<!-- --> <!-- --> · <!-- -->20 min read</time></div></div></div></header><div class="markdown"><p>Recently Meta announced the release of Buck2, their official build tool that was rewritten in Rust.
I got a chance to try it and integrate it with BuildBuddy&#x27;s Remote Cache and Remote Build Execution offerings.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/buck2-780fab897c58d52a2c5e43171a00a001.jpg" width="800" height="485" class="img_ev3q"></p>
<p>Here are the initial impressions I have after a week of using Buck2.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p><strong>Edit</strong> (2023-06-15): The Bazel team did reach out to me with some corrections to how the benchmark
was setup. Please find revised numbers at bottom of this blog.</p>
<p>Similar to Buck(1) and Bazel, Buck2 is an <a href="https://bazel.build/basics/artifact-based-builds" target="_blank" rel="noopener noreferrer">artifact-based</a> build tool that operates on a large graph of dependencies.</p>
<p>Buck2 was rewritten from scratch in Rust while providing many backward compatibility features with Buck(1).
On the <a href="https://buck2.build/docs/why/" target="_blank" rel="noopener noreferrer">official website of Buck2</a>, Meta touted it to be:</p>
<ol>
<li>Remote Execution first</li>
<li>Dynamic graph computation engine</li>
<li>A single build phase</li>
</ol>
<p>So how true are these claims?
Is Buck2 going to replace Bazel?
Is this the right tool for your needs?</p>
<p>Let&#x27;s dive in!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-pros">The pros<a href="#the-pros" class="hash-link" aria-label="Direct link to The pros" title="Direct link to The pros">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="incredible-cli-ux">Incredible CLI UX<a href="#incredible-cli-ux" class="hash-link" aria-label="Direct link to Incredible CLI UX" title="Direct link to Incredible CLI UX">​</a></h4>
<p>Right out of the box, Buck2 feels incredibly responsive.
The command line is ridiculously fast compared to Bazel 6.2.0.
Here, we are using <a href="https://github.com/sharkdp/hyperfine" target="_blank" rel="noopener noreferrer">Hyperfine</a> to benchmark the two build tools.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;buck2 --version&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--shell</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">none </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--warmup</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--runs</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">: buck2 </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:       </span><span class="token number" style="color:rgb(181, 206, 168)">5.5</span><span class="token plain"> ms ±   </span><span class="token number" style="color:rgb(181, 206, 168)">0.6</span><span class="token plain"> ms    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">2.7</span><span class="token plain"> ms, System: </span><span class="token number" style="color:rgb(181, 206, 168)">1.4</span><span class="token plain"> ms</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:     </span><span class="token number" style="color:rgb(181, 206, 168)">5.0</span><span class="token plain"> ms …   </span><span class="token number" style="color:rgb(181, 206, 168)">7.1</span><span class="token plain"> ms    </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> runs</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel version&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--shell</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">none </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--warmup</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--runs</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">: bazel version</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:      </span><span class="token number" style="color:rgb(181, 206, 168)">31.2</span><span class="token plain"> ms ±   </span><span class="token number" style="color:rgb(181, 206, 168)">0.7</span><span class="token plain"> ms    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">9.7</span><span class="token plain"> ms, System: </span><span class="token number" style="color:rgb(181, 206, 168)">11.8</span><span class="token plain"> ms</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:    </span><span class="token number" style="color:rgb(181, 206, 168)">29.8</span><span class="token plain"> ms …  </span><span class="token number" style="color:rgb(181, 206, 168)">32.4</span><span class="token plain"> ms    </span><span class="token number" style="color:rgb(181, 206, 168)">20</span><span class="token plain"> runs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Moreover, the CLI was written in Rust&#x27;s Clap library, which comes with a sane help menu
and (soon to come) auto-completion.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> buck2 </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">buck2 42652bf853883e0391382f6b8d038fe6 </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">local</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">A build system</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Documentation: https://buck2.build/docs/</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">USAGE:</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    buck2 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">OPTIONS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">SUBCOMMAND</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">OPTIONS:</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    -h, </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--help</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Print </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">help</span><span class="token plain"> information</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        --isolation-dir </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ISOLATION_DIR</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Instances of Buck2 share a daemon </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> and only </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> their isolation directory is identical.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            The isolation directory also influences the output paths provided by Buck2, and as a</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            result using a non-default isolation </span><span class="token function" style="color:rgb(220, 220, 170)">dir</span><span class="token plain"> will cause cache misses </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">and slower builds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">env: </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">BUCK_ISOLATION_DIR</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">default: v2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    -v, </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--verbose</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NUMBER</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            How verbose buck should be </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> logging. Values: </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Quiet, errors only</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> info about errors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> info about everything </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">default: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    -V, </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Print version information</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">SUBCOMMANDS:</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    aquery       Perform queries on the action graph </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">experimental</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    audit        Perform lower level queries</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    build        Build the specified targets</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    bxl          Run BXL scripts</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    clean        Delete generated files and caches</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    cquery       Perform queries on the configured target graph</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    ctargets     Resolve target patterns to configured targets</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    docs         Print documentation of specified symbols</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">help</span><span class="token plain">         Print this message or the </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">help</span><span class="token plain"> of the given subcommand</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    init         Initialize a buck2 project</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">install</span><span class="token plain">      Build and </span><span class="token function" style="color:rgb(220, 220, 170)">install</span><span class="token plain"> an application</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">kill</span><span class="token plain">         Kill the buck daemon</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">killall</span><span class="token plain">      Kill all buck2 processes on the machine</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    log          Commands </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> interacting with buck2 logs</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    lsp          Start an LSP server </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> starlark files</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    profile      Profiling mechanisms</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    query        Alias </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token variable" style="color:rgb(156, 220, 254)">uquery</span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    rage         Record information about the previous failed buck2 </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    root         Find buck cell, project or package root</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    run          Build and run the selected target</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    server       Start, query, and control the http server</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    starlark     Run Starlark operations</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    status       Buckd status</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    subscribe    Subscribe to updates from the Buck2 daemon</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    targets      Show details about the specified targets</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain">         Build and </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> the specified targets</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    uquery       Perform queries on the unconfigured target graph</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This means that even the subcommands flags are declared with the framework and
comes with amazing default documentation.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> buck2 rage </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">buck2-rage</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Record information about the previous failed buck2 </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">USAGE:</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    buck2 rage </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">OPTIONS</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">OPTIONS:</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    -h, </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--help</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Print </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">help</span><span class="token plain"> information</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        --invocation-id </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">INVOCATION_ID</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Select invocation directly using the invocation&#x27;s UUID</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        --invocation-offset </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">INVOCATION_OFFSET</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Use value </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> to </span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> last invocation, </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> to </span><span class="token keyword" style="color:rgb(86, 156, 214)">select</span><span class="token plain"> second to last and so on</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        --no-invocation</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Collect rage report about buck2 </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> general, not about specific invocation</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        --no-paste</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            We may want to omit </span><span class="token function" style="color:rgb(220, 220, 170)">paste</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> this is not a user or is called </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> a machine with no pastry</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">command</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--origin</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">ORIGIN</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Where buck2 rage is being called from </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">default: unspecified</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">possible values:</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            hang-detector, unspecified</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--timeout</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">TIMEOUT</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            Stop collecting information after </span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token variable operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token variable" style="color:rgb(156, 220, 254)">timeout</span><span class="token variable operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token variable" style="color:rgb(156, 220, 254)">`</span><span class="token plain"> seconds </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">default: </span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    -v, </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--verbose</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">NUMBER</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            How verbose buck should be </span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> logging. Values: </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> Quiet, errors only</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> default</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> info about errors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">more</span><span class="token plain"> info about everything </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">default: </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The build progress library was custom-made for Buck2 and can sort and color-code slower actions.
Here is a quick sped up demo:</p>
<p><img decoding="async" loading="lazy" src="/assets/images/buck2-success-d388fa5c0141b3aa94952bbb94f8732c.gif" width="777" height="250" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="first-class-remote-execution">First-class Remote Execution<a href="#first-class-remote-execution" class="hash-link" aria-label="Direct link to First-class Remote Execution" title="Direct link to First-class Remote Execution">​</a></h4>
<p>Buck2 was not kidding about it being a &quot;Remote Execution first&quot; build tool.</p>
<p>Thanks to this assumption, Buck2 was able to cut corners by not providing any local-sandboxing implementations by default.
What seems to be an unwanted side-effect at scale, actually made the tool more friendly to new learners.
The lack of local sandboxing allows Buck2 to behave locally closer to other task-runner build tools such as Make or Just.</p>
<p>However, any mistakes that are made when authoring build definitions locally will very soon be revealed once moved to Remote Build Execution.
Buck2 follows the same industry standard <a href="https://github.com/bazelbuild/remote-apis" target="_blank" rel="noopener noreferrer">Remote Execution API</a> that was adopted by the like of Bazel, Goma, Pants, Please, Recc...
This means that Buck2 is compatible with BuildBuddy Remote Cache and Remote Build Execution offering! 🎉</p>
<p>So let&#x27;s test it out!</p>
<p>First, let&#x27;s establish a setup to benchmark our test</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">SIZE_RANGE </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(86, 156, 214)">range</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1000</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">XYZ_SHA256 </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;72036ae48c55d632cc333cac04c78be336b0c76f39b225d023e218efe077ab1b&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Add some execution time to each action to simulate a real build.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">SLEEP_CMD </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;sleep $$((RANDOM % 5));&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Stage 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    genrule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;x_{}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        outs </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;x_{}.txt&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        cmd </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SLEEP_CMD </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;echo x_{} &gt; $@&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> n </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    genrule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;y_{}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        outs </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;y_{}.txt&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        cmd </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SLEEP_CMD </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;echo y_{} &gt; $@&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> n </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Stage 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    genrule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;z_{}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        outs </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;z_{}.txt&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        cmd </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SLEEP_CMD </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;cat $(location :x_{n}) $(location :y_{n}) &gt; $@&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        tools </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:x_{}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:y_{}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> n </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Stage 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">genrule</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;xyz&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    outs </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;xyz.txt&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># cat $(location :z_0) $(location :z_1) ... $(location :z_999) &gt; $@,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    cmd </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> SLEEP_CMD </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;cat &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">join</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;$(location :z_{})&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> n </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot; &gt; $@&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    tools </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:z_{}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token builtin" style="color:rgb(86, 156, 214)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> n </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Stage 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">sh_test</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    name </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;test&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    srcs </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;test.sh&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    args </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;$(location :xyz)&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        XYZ_SHA256</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    data </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">        </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;:xyz&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Our setup is a build graph composed of 4 stages:</p>
<ul>
<li>
<p>Stage 1: Create 1000 &quot;x&quot; targets and 1000 &quot;y&quot; targets (2000 build targets)</p>
</li>
<li>
<p>Stage 2: Create 1000 &quot;z&quot; targets by concat &quot;x&quot; and &quot;y&quot; from Stage 1 (1000 build targets)</p>
</li>
<li>
<p>Stage 3: Concat all &quot;z&quot; targets (1 build target)</p>
</li>
<li>
<p>Stage 4: Validate stage 3 output with a test (1 test target)</p>
</li>
</ul>
<p>Before each action, we sleep a random duration between 0 and 4 seconds to make the simulation closer to real-world build.</p>
<p>We also inject this sleep value into our test to help validate testing features down the line:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">cat</span><span class="token plain"> test.sh</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">file</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">expected</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">got</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable" style="color:rgb(156, 220, 254)">sha256sum $file </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">awk</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable string" style="color:rgb(206, 145, 120)">&#x27;{print $1}&#x27;</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">sleep</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$((</span><span class="token variable" style="color:rgb(156, 220, 254)">RANDOM </span><span class="token variable operator" style="color:rgb(212, 212, 212)">%</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable number" style="color:rgb(181, 206, 168)">5</span><span class="token variable" style="color:rgb(156, 220, 254)">))</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$expected</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$got</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With a total of 2002 user-defined targets and 4 stages, assuming perfect concurrency,
it should result in a worst-case 16 seconds, average 8 seconds, sleep overhead.</p>
<p>Let&#x27;s use Bazel&#x27;s latest release, 6.2.0, as our baseline and see how Buck2 compares.</p>
<ol>
<li>
<p>Local Execution</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">cat</span><span class="token plain"> .bazelrc</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:local </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--strategy</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">local</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:local </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--jobs</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:local </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--local_cpu_resources</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">200</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:local </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--local_ram_resources</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;HOST_RAM*2.0&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s worth noting that Bazel executes actions in a sandbox by default, so <code>--strategy=local</code> is used here to explicitly disable sandboxing.
We also set Bazel&#x27;s concurrency limit to 200 by specifying <code>--jobs=200</code> and override Bazel&#x27;s system resource estimations by specifying
<code>--local_cpu_resources</code> and <code>--local_ram_resources</code> to larger values.
Because our actions are lightweight, with majority of the time being spent on <code>sleep(1)</code> call,
these Bazel flags enable us to hit the &quot;200 concurrent build actions&quot; mark.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--prepare</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel clean&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--warmup</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel test --config=local //...&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">: bazel </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">local //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:     </span><span class="token number" style="color:rgb(181, 206, 168)">65.631</span><span class="token plain"> s ±  </span><span class="token number" style="color:rgb(181, 206, 168)">0.460</span><span class="token plain"> s    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">0.051</span><span class="token plain"> s, System: </span><span class="token number" style="color:rgb(181, 206, 168)">0.063</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:   </span><span class="token number" style="color:rgb(181, 206, 168)">65.179</span><span class="token plain"> s … </span><span class="token number" style="color:rgb(181, 206, 168)">66.310</span><span class="token plain"> s    </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> runs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To ensure fairness, we also set Buck2 execution concurrency to the same value as Bazel:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-2</span><span class="token plain"> .buckconfig</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">build</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">threads </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here, Buck&#x27;s Starlark API differs slightly from Bazel&#x27;s, so some small modifications were needed.
For example:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">@@ -21,9 +21,9 @@</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> [</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     genrule(</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">         name = &quot;z_{}&quot;.format(n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-        outs = [&quot;z_{}.txt&quot;.format(n)],</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+        out = &quot;z_{}.txt&quot;.format(n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-        cmd = &quot;cat $(location :x_{n}) $(location :y_{n}) &gt; $@&quot;.format(n = n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+        cmd = &quot;cat $(location :x_{n}) $(location :y_{n}) &gt;$OUT&quot;.format(n = n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-        tools = [</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+        srcs = [</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">             &quot;:x_{}&quot;.format(n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">             &quot;:y_{}&quot;.format(n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">         ],</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With all that set, let&#x27;s see how Buck2 performs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine  </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--prepare</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;buck2 clean&#x27;</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--warmup</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;buck2 test //...&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">: buck2 </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:     </span><span class="token number" style="color:rgb(181, 206, 168)">41.175</span><span class="token plain"> s ±  </span><span class="token number" style="color:rgb(181, 206, 168)">2.183</span><span class="token plain"> s    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">0.371</span><span class="token plain"> s, System: </span><span class="token number" style="color:rgb(181, 206, 168)">0.190</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:   </span><span class="token number" style="color:rgb(181, 206, 168)">37.584</span><span class="token plain"> s … </span><span class="token number" style="color:rgb(181, 206, 168)">43.803</span><span class="token plain"> s    </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> runs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And quite a performance indeed, Buck2 left Bazel in the dust!</p>
</li>
<li>
<p>Remote Execution</p>
<p>Using BuildBuddy as the RBE backend should be as simple as copying the configurations from the website:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">build:remote --jobs=600</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:remote --bes_results_url=https://app.buildbuddy.io/invocation/</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:remote --bes_backend=grpcs://remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:remote --remote_cache=grpcs://remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:remote --remote_timeout=3600</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:remote --remote_executor=grpcs://remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">build:remote --remote_header=x-buildbuddy-api-key=&lt;redacted&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With that set, let&#x27;s check the result:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token comment" style="color:rgb(106, 153, 85)"># With remote cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--prepare</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel clean&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--warmup</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel test --config=remote //...&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">: bazel </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:      </span><span class="token number" style="color:rgb(181, 206, 168)">9.798</span><span class="token plain"> s ±  </span><span class="token number" style="color:rgb(181, 206, 168)">0.515</span><span class="token plain"> s    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">0.028</span><span class="token plain"> s, System: </span><span class="token number" style="color:rgb(181, 206, 168)">0.039</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:    </span><span class="token number" style="color:rgb(181, 206, 168)">8.645</span><span class="token plain"> s … </span><span class="token number" style="color:rgb(181, 206, 168)">10.434</span><span class="token plain"> s    </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> runs</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Without remote cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Set remote_instance_name to a random string to reset remote_cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine  </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--prepare</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel clean&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">             </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--warmup</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">             </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel test --config=remote --remote_instance_name=&quot;$RANDOM&quot; //...&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">: bazel </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--remote_instance_name</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token string environment constant" style="color:rgb(100, 102, 149)">$RANDOM</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;</span><span class="token plain"> //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:     </span><span class="token number" style="color:rgb(181, 206, 168)">106.062</span><span class="token plain"> s ±  </span><span class="token number" style="color:rgb(181, 206, 168)">3.106</span><span class="token plain"> s    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">0.090</span><span class="token plain"> s, System: </span><span class="token number" style="color:rgb(181, 206, 168)">0.099</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:   </span><span class="token number" style="color:rgb(181, 206, 168)">102.111</span><span class="token plain"> s … </span><span class="token number" style="color:rgb(181, 206, 168)">111.645</span><span class="token plain"> s    </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> runs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>10 seconds is amazing compared to the local execution time of 65 seconds.
It&#x27;s 84% faster with Remote Build Execution and Remote Cache!</p>
<p>But what about Buck2?
Well setting it up is as simple as copying the provided configurations in <a href="https://github.com/facebook/buck2/tree/main/examples/remote_execution/buildbuddy" target="_blank" rel="noopener noreferrer">Buck2&#x27;s BuildBuddy Example</a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">build</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">execution_platforms </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> root//platforms:platforms</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># [buck2_re_client]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">engine_address </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">action_cache_address </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">cas_address </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">http_headers </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> x-buildbuddy-api-key:</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">redacted</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s run it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token comment" style="color:rgb(106, 153, 85)"># With remote cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--prepare</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;buck2 clean&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--warmup</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;buck2 test --unstable-allow-all-tests-on-re //...&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:      </span><span class="token number" style="color:rgb(181, 206, 168)">7.937</span><span class="token plain"> s ±  </span><span class="token number" style="color:rgb(181, 206, 168)">0.487</span><span class="token plain"> s    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">0.296</span><span class="token plain"> s, System: </span><span class="token number" style="color:rgb(181, 206, 168)">0.175</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:    </span><span class="token number" style="color:rgb(181, 206, 168)">7.357</span><span class="token plain"> s …  </span><span class="token number" style="color:rgb(181, 206, 168)">8.945</span><span class="token plain"> s    </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> runs</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># Without remote cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--prepare</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;buck2 clean; echo &quot;INSTANCE_NAME = \&quot;$RANDOM\&quot;&quot; &gt; instance.bzl&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;buck2 test --unstable-allow-all-tests-on-re //...&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">: buck2 </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> --unstable-allow-all-tests-on-re //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:     </span><span class="token number" style="color:rgb(181, 206, 168)">203.431</span><span class="token plain"> s ± </span><span class="token number" style="color:rgb(181, 206, 168)">29.882</span><span class="token plain"> s    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">4.187</span><span class="token plain"> s, System: </span><span class="token number" style="color:rgb(181, 206, 168)">1.566</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:   </span><span class="token number" style="color:rgb(181, 206, 168)">163.044</span><span class="token plain"> s … </span><span class="token number" style="color:rgb(181, 206, 168)">258.968</span><span class="token plain"> s    </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> runs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Buck2 does not have a good way to invalidate the remote cache to give a fair comparison,
so I did apply a workaround by invalidating all the <code>x</code> and <code>y</code> actions with a random value instead.</p>
<p>Regardless, the performance was very impressive.
The Remote Build Execution client of Buck2 is not as configurable as Bazel, so it was harder to tune.
I expect it will make builds perform much better in the future.</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="easy-to-contribute">Easy to contribute<a href="#easy-to-contribute" class="hash-link" aria-label="Direct link to Easy to contribute" title="Direct link to Easy to contribute">​</a></h4>
<p>Seriously, Buck2 code base is a blast to work with.
Unlike Bazel, which was written in a mix of C++ and Java using Google&#x27;s homegrown frameworks,
Buck2 was built with a single language: Rust!</p>
<p>Not only can the code base be built using Buck2, but it could also be built using Cargo, and
is completely compatible with Rust Analyzer (Rust&#x27;s Language Server).
It has been a long time since I could open the code base of a build tool and have &quot;Go to definitions&quot;
and &quot;Find references&quot; work out of the box.</p>
<p>The Buck2 team in Meta has been quite engaging thus far.
It often takes them less than a week to respond to my GitHub Issues / Pull Requests.
And most of the time, I get a response within a day.</p>
<p>Diving into Buck2 and its Rust code base is... addictive. 😅</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-cons">The cons<a href="#the-cons" class="hash-link" aria-label="Direct link to The cons" title="Direct link to The cons">​</a></h2>
<blockquote>
<p>So is that it? Buck2 is faster, let&#x27;s all move there?</p>
</blockquote>
<p>Not so fast young padawan!
Buck2 does come with some downsides.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="its-actually-multiple-phases">It&#x27;s actually multiple phases!<a href="#its-actually-multiple-phases" class="hash-link" aria-label="Direct link to It&#x27;s actually multiple phases!" title="Direct link to It&#x27;s actually multiple phases!">​</a></h4>
<p>In contrary to it&#x27;s official introduction, <a href="https://buck2.build/docs/developers/architecture/buck2/" target="_blank" rel="noopener noreferrer">Buck2&#x27;s architecture diagram</a>
describes multiple phases and stages inside a typical build.</p>
<p><img decoding="async" loading="lazy" src="/assets/images/buck2_architecture-2404c487eb4c04045a09b9c7e27dd867.png" width="2060" height="1256" class="img_ev3q"></p>
<p>There seems to be 5 Phases acting as transitions between 5 states of Buck2 dynamic build graph, <a href="https://github.com/facebook/buck2/tree/main/dice" target="_blank" rel="noopener noreferrer">DICE</a>.</p>
<p>The good thing about Buck2 is that none of these phases are &quot;blocking&quot;, and thus multiple targets could
transition through different states in great parallelization. Bazel is also trying to work toward this
setup with the recently announced <a href="https://www.youtube.com/watch?v=IEJLHNNRP9U&amp;list=PLxNYxgaZ8RsdH4GCIZ69dzxQCOPyuNlpF&amp;index=10" target="_blank" rel="noopener noreferrer">SkyMeld project</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="no-build-telemetry">No Build Telemetry<a href="#no-build-telemetry" class="hash-link" aria-label="Direct link to No Build Telemetry" title="Direct link to No Build Telemetry">​</a></h4>
<p>First of all, because Buck2 does not implement Bazel&#x27;s Build Event Stream protocol (not part of Remote Execution API),
we are not able to integrate with it to display your test results and provide you with sweet cache hit/miss analysis as we have with Bazel.</p>
<p>Buck2 does come with a proto-defined set of <code>BuckEvent</code> data.
Currently, these log-like data are stored locally under <code>buck-out/log</code> and could be interacted with using troubleshooting commands such as <code>buck2 what-failed</code>.</p>
<p>Internally in Meta, these log data are sent to their <a href="https://engineering.fb.com/2019/10/07/data-infrastructure/scribe/" target="_blank" rel="noopener noreferrer">message queue system Scribe</a> using Thrift RPC, which is consumed by their Telemetry Data platform <a href="https://research.facebook.com/publications/scuba-diving-into-data-at-facebook/" target="_blank" rel="noopener noreferrer">Scuba</a>.
However, there is no open-source implementation equivalent and I created <a href="https://github.com/facebook/buck2/issues/226" target="_blank" rel="noopener noreferrer">buck2/issue/226</a> to discuss the creation of one.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="no-repository-phase">No Repository Phase<a href="#no-repository-phase" class="hash-link" aria-label="Direct link to No Repository Phase" title="Direct link to No Repository Phase">​</a></h4>
<p>In Bazel, external dependencies to the build are prepared before build execution happens, in the &quot;Repository Phase&quot;.</p>
<p>Buck2 is touted to be a single phases build tool, so how does it manage 3rd party dependencies then?
Currently, there are only a limited set of options:</p>
<ol>
<li>
<p>Git submodules
Buck2 comes with <strong>Prelude</strong>, an open-source git repository that is meant to help define most Buck2 build rules.
However, for each new Buck2 project being created with <code>buck2 init</code>, you would need to set up Prelude as a git submodule in your git repo.
Without prelude, you would not get access to even basic rules such as <code>genrule</code> or <code>sh_binary</code>.</p>
</li>
<li>
<p>Vendor
Since the majority of Buck2 is written in Rust, the companion tool <strong>Reindeer</strong> helps you vendor all
Cargo external packages into the repository and set up appropriate <code>BUCK</code> files for them.
This is not a problem for Meta internally, with their custom monorepo and virtual file system <a href="https://sapling-scm.com/" target="_blank" rel="noopener noreferrer">Sapling</a>,
but it should be a huge problem for Git repos and code review systems in the open-source world.</p>
</li>
<li>
<p>Anon target and dynamic outputs
Although there is no repository phase, you could still define <code>http_archive</code> to have external downloads happen during Buck2 build execution.
However, you will not be able to export build targets out of these newly downloaded archives easily.
Instead of the Bazel approach which lets you run some commands to generate <code>BUILD</code> files,
Buck2 provides the complicated anon target, sub-targets, and dynamic outputs APIs in Starlark for you to accomplish the same thing.
However, there is very limited documentation and examples of how these APIs work.</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="complicated-testing-abstraction">Complicated testing abstraction<a href="#complicated-testing-abstraction" class="hash-link" aria-label="Direct link to Complicated testing abstraction" title="Direct link to Complicated testing abstraction">​</a></h4>
<p>Unlike Bazel, which treats tests as another build action to be executed at the end of the graph,
Buck2 took this to a whole new level by introducing a new RPC to integrate Buck2 with their internal testing platform <a href="https://buck2.build/docs/rule_authors/test_execution/" target="_blank" rel="noopener noreferrer">TPX</a>.</p>
<p>Because TPX is in charge of coordinating test executions on various platforms and collecting related test outputs data,
the set of APIs that define integration between Buck2 and TPX is also quite featureful.
However, there is not a lot of documentation at this moment regarding how these work.</p>
<p>Because of this reason, there is no test caching in Buck2 by default as the test target selector is supposed to be handled. But there are ongoing conversation about this in <a href="https://github.com/facebook/buck2/issues/183" target="_blank" rel="noopener noreferrer">buck2/issue/183</a>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-foot-guns">Other foot guns<a href="#other-foot-guns" class="hash-link" aria-label="Direct link to Other foot guns" title="Direct link to Other foot guns">​</a></h4>
<p>There are several pain points I experienced while testing out Buck2. They range from small annoyances to rendering the tool completely un-usable 😓:</p>
<ul>
<li>
<p><code>http_archive</code> does not work from within anon target. Fixed in <a href="https://github.com/facebook/buck2-prelude/commit/370cd4d8b2cd002e0f794b91520febcab289b7d0" target="_blank" rel="noopener noreferrer">buck2/commit/370cd4d</a>.</p>
</li>
<li>
<p>All Go rules are not usable without a standard library to compile/link against. Reported in <a href="https://github.com/facebook/buck2/issues/240" target="_blank" rel="noopener noreferrer">buck2/issue/240</a>.</p>
</li>
<li>
<p>Lack of documentation for <code>.buckconfig</code> keys and default values. Reported in <a href="https://github.com/facebook/buck2/issues/152" target="_blank" rel="noopener noreferrer">buck2/issue/152</a>.</p>
</li>
<li>
<p>No local cache for external downloads (leading to re-download happening on a Buck Daemon reset). Reported in <a href="https://github.com/facebook/buck2/issues/246" target="_blank" rel="noopener noreferrer">buck2/issue/246</a>.</p>
</li>
<li>
<p>Terminal UI reported the wrong value for actions counts. Reported in <a href="https://github.com/facebook/buck2/issues/251" target="_blank" rel="noopener noreferrer">buck2/issue/251</a>.</p>
</li>
<li>
<p>Remote Execution does not have symlinks support <a href="https://github.com/facebook/buck2/issues/222" target="_blank" rel="noopener noreferrer">buck2/issue/222</a>.</p>
</li>
<li>
<p>Simply crash and not usable <a href="https://github.com/facebook/buck2/issues/257" target="_blank" rel="noopener noreferrer">buck2/issue/257</a>, but fixed with <a href="https://github.com/facebook/buck2/commit/79471567dd5e05f4035515c697e3fb9ef78622ac" target="_blank" rel="noopener noreferrer">buck2/commit/7947156</a>.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-verdict">The verdict<a href="#the-verdict" class="hash-link" aria-label="Direct link to The verdict" title="Direct link to The verdict">​</a></h2>
<blockquote>
<p>So what does all this mean?</p>
<p>Should I start using Buck2 today?</p>
</blockquote>
<p>Buck2 is a fresh, new shiny build tool on the block.
With it comes a lot of good things:</p>
<ul>
<li>
<p>Great language, great performance</p>
</li>
<li>
<p>Fresh UI</p>
</li>
<li>
<p>Compatibility with existing RBE services</p>
</li>
</ul>
<p>It has all the joy and excitement of a typical green field project that attracts the Rust (and potentially C++) community toward it.</p>
<blockquote>
<p>But is it a Bazel replacement?</p>
<p>Should an enterprise consider adopting this for hundreds to thousands of users?</p>
</blockquote>
<p>I would say <em>not yet</em>!</p>
<ul>
<li>
<p>There are still too many foot guns that come with the new tool (as documented above).</p>
</li>
<li>
<p>There is not enough configurations and/or documentation to support large-scale enterprise users.</p>
</li>
<li>
<p>Users are expected to be hands-on with the code base. If you don&#x27;t know Rust... well you better learn it first.</p>
</li>
<li>
<p>Lack of build rules and toolings for typical use cases: building a container image, a typescript project, a go binary... are not possible just yet.</p>
</li>
</ul>
<p>My conclusion is that Buck2 is exciting!
However, today, it&#x27;s still young and too early to replace typical enterprise use cases.
I hope the current excitement could grow a community and ecosystem around Buck2 sustainably to further drive the tool to maturity.</p>
<p>In the meantime, I have created a repository to collect <a href="https://github.com/sluongng/awesome-buck2" target="_blank" rel="noopener noreferrer">all Buck2-related resources here</a>.
If you are interested in Buck2, give it a look!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-2023-06-15">Update (2023-06-15)<a href="#update-2023-06-15" class="hash-link" aria-label="Direct link to Update (2023-06-15)" title="Direct link to Update (2023-06-15)">​</a></h2>
<p>Shortly after this blog post was released, <a href="https://github.com/meisterT" target="_blank" rel="noopener noreferrer">Tobias Werth</a> from the Bazel team pointed out to me
that the Bazel setup was not the most optimized.</p>
<p>In particular, instead of using the <code>tools</code> attribute in Bazel&#x27;s <code>genrule</code>, I should have used <code>srcs</code> instead.</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">--- a/BUILD.bazel</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+++ b/BUILD.bazel</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">@@ -26,28 +26,28 @@ SLEEP_CMD = &quot;sleep $$((RANDOM % 5));&quot;</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> [</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     genrule(</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">         name = &quot;z_{}&quot;.format(n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-        outs = [&quot;z_{}.txt&quot;.format(n)],</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-        cmd = SLEEP_CMD + &quot;cat $(location :x_{n}) $(location :y_{n}) &gt; $@&quot;.format(n = n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-        tools = [</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+        srcs = [</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">             &quot;:x_{}&quot;.format(n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">             &quot;:y_{}&quot;.format(n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">         ],</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+        outs = [&quot;z_{}.txt&quot;.format(n)],</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+        cmd = SLEEP_CMD + &quot;cat $(location :x_{n}) $(location :y_{n}) &gt; $@&quot;.format(n = n),</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     )</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     for n in SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> ]</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> genrule(</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     name = &quot;xyz&quot;,</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+    srcs = [</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+        &quot;:z_{}&quot;.format(n)</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+        for n in SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+    ],</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     outs = [&quot;xyz.txt&quot;],</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     # cat $(location :z_0) $(location :z_1) ... $(location :z_999) &gt; $@,</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     cmd = SLEEP_CMD + &quot;cat &quot; + &quot; &quot;.join([</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">         &quot;$(location :z_{})&quot;.format(n)</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">         for n in SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">     ]) + &quot; &gt; $@&quot;,</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-    tools = [</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-        &quot;:z_{}&quot;.format(n)</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-        for n in SIZE_RANGE</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-    ],</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using <code>tools</code> would cause Bazel to configure twice the number of actions underneath due to Bazel&#x27;s special treatment of tool dependencies.
And fewer actions means a faster build.</p>
<p>So I reran the benchmark and here are the new results:</p>
<table><thead><tr><th style="text-align:left">Tools</th><th style="text-align:right">Local Build</th><th style="text-align:right">RBE (with Remote Cache)</th><th style="text-align:right">RBE (without Remote Cache)</th></tr></thead><tbody><tr><td style="text-align:left">buck2</td><td style="text-align:right"><code>41.175 s ± 2.183 s</code></td><td style="text-align:right"><code> 7.937 s ± 0.487 s</code></td><td style="text-align:right"><code>203.431 s ± 29.882 s</code></td></tr><tr><td style="text-align:left">bazel w. <code>tools</code></td><td style="text-align:right"><code>65.631 s ± 0.460 s</code></td><td style="text-align:right"><code> 9.798 s ± 0.515 s</code></td><td style="text-align:right"><code>106.062 s ± ‎ 3.106 s</code></td></tr><tr><td style="text-align:left">bazel w. <code>srcs</code></td><td style="text-align:right"><code>42.580 s ± 1.881 s</code></td><td style="text-align:right"><code>10.047 s ± 0.517 s</code></td><td style="text-align:right"><code> 73.009 s ± ‎ 2.975 s</code></td></tr></tbody></table>
<p>This means that if setup correctly, Bazel performance is quite competitive with Buck2.
Differences of a few seconds could be negligible for most use cases.</p>
<p>Another point of improvement is using the default BuildBuddy setting, we are uploading Bazel&#x27;s Build Events to BuildBuddy on each build.
With Buck2, there is an equivalent Buck2 Event system.
However, as noted in the blog post, Buck2 Event system is not yet compatible with systems outside of Meta so it&#x27;s not possible to test with it just yet.</p>
<p>So to achieve a more accurate test result, we could move Bazel&#x27;s Build Event upload to a separate config as follows:</p>
<div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token plain">--- a/.bazelrc</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+++ b/.bazelrc</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">@@ -14,12 +14,14 @@ build:remote --host_platform=//platforms:platform_linux</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> build:remote --platforms=//platforms:platform_linux</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> build:remote --crosstool_top=@buildbuddy_toolchain//:ubuntu_cc_toolchain_suite</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-build:remote --bes_results_url=https://app.buildbuddy.io/invocation/</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">-build:remote --bes_backend=grpcs://remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> build:remote --remote_cache=grpcs://remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> build:remote --remote_timeout=3600</span><br></span><span class="token-line" style="color:#fff"><span class="token plain"> build:remote --remote_executor=grpcs://remote.buildbuddy.io</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+build:remote-w-bes --config=remote</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+build:remote-w-bes --bes_results_url=https://app.buildbuddy.io/invocation/</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">+build:remote-w-bes --bes_backend=grpcs://remote.buildbuddy.io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>How much of an improvement is it?</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#fff;--prism-background-color:#212121"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#fff;background-color:#212121"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#fff"><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> hyperfine </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--prepare</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel clean&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--warmup</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel test --config=remote //...&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">            </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;bazel test --config=remote-w-bes //...&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">: bazel </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:      </span><span class="token number" style="color:rgb(181, 206, 168)">6.208</span><span class="token plain"> s ±  </span><span class="token number" style="color:rgb(181, 206, 168)">0.444</span><span class="token plain"> s    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">0.022</span><span class="token plain"> s, System: </span><span class="token number" style="color:rgb(181, 206, 168)">0.031</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:    </span><span class="token number" style="color:rgb(181, 206, 168)">5.392</span><span class="token plain"> s …  </span><span class="token number" style="color:rgb(181, 206, 168)">6.860</span><span class="token plain"> s    </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> runs</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Benchmark </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain">: bazel </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote-w-bes //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Time </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">mean ± σ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:     </span><span class="token number" style="color:rgb(181, 206, 168)">10.299</span><span class="token plain"> s ±  </span><span class="token number" style="color:rgb(181, 206, 168)">0.300</span><span class="token plain"> s    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">User: </span><span class="token number" style="color:rgb(181, 206, 168)">0.025</span><span class="token plain"> s, System: </span><span class="token number" style="color:rgb(181, 206, 168)">0.036</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  Range </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">min … max</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">:    </span><span class="token number" style="color:rgb(181, 206, 168)">9.811</span><span class="token plain"> s … </span><span class="token number" style="color:rgb(181, 206, 168)">10.739</span><span class="token plain"> s    </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"> runs</span><br></span><span class="token-line" style="color:#fff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#fff"><span class="token plain">Summary</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">  bazel </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">. ran</span><br></span><span class="token-line" style="color:#fff"><span class="token plain">    </span><span class="token number" style="color:rgb(181, 206, 168)">1.66</span><span class="token plain"> ± </span><span class="token number" style="color:rgb(181, 206, 168)">0.13</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">times</span><span class="token plain"> faster than bazel </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--config</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">remote-w-bes //</span><span class="token punctuation" style="color:rgb(212, 212, 212)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="putting-all-new-improvements-together">Putting all new improvements together<a href="#putting-all-new-improvements-together" class="hash-link" aria-label="Direct link to Putting all new improvements together" title="Direct link to Putting all new improvements together">​</a></h4>
<p>Here are the new benchmark results:</p>
<table><thead><tr><th style="text-align:left">Tools</th><th style="text-align:right">Local Build</th><th style="text-align:right">RBE (with Remote Cache)</th><th style="text-align:right">RBE (without Remote Cache)</th></tr></thead><tbody><tr><td style="text-align:left">buck2</td><td style="text-align:right"><code>41.175 s ± 2.183 s</code></td><td style="text-align:right"><code> 7.937 s ± 0.487 s</code></td><td style="text-align:right"><code>203.431 s ± 29.882 s</code></td></tr><tr><td style="text-align:left">bazel w. <code>tools</code> (old)</td><td style="text-align:right"><code>65.631 s ± 0.460 s</code></td><td style="text-align:right"><code> 9.798 s ± 0.515 s</code></td><td style="text-align:right"><code>106.062 s ± ‎ 3.106 s</code></td></tr><tr><td style="text-align:left">bazel w. <code>srcs</code></td><td style="text-align:right"><code>42.580 s ± 1.881 s</code></td><td style="text-align:right"><code>10.047 s ± 0.517 s</code></td><td style="text-align:right"><code> 73.009 s ± ‎ 2.975 s</code></td></tr><tr><td style="text-align:left">bazel<br>w. <code>srcs</code>, no <code>BES</code></td><td style="text-align:right"><code>40.455 s ± 2.275 s</code></td><td style="text-align:right"><code> 6.208 s ± 0.444 s</code></td><td style="text-align:right"><code> 70.788 s ± ‎ 4.408 s</code></td></tr></tbody></table>
<p>This shows that when configured correctly, Bazel&#x27;s performance is very competitive with Buck2&#x27;s,
and that Buck2 still has some room for growth in areas such as Remote Build Execution.</p>
<p>Interested readers could find my benchmarking setup in Github repo <a href="https://github.com/sluongng/buck2-rbe-bench" target="_blank" rel="noopener noreferrer">sluongng/buck2-rbe-bench</a>
to experiment further.</p></div><footer class="row margin-vert--lg"><div class="tags_OHNp"><strong>Tags:</strong><a class="tag_p3At" href="/blog/tags/buck-2">buck2</a><a class="tag_p3At" href="/blog/tags/engineering">engineering</a></div></footer></article><div><a href="https://github.com/buildbuddy-io/buildbuddy/edit/master/website/blog/buck2.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/customer-managed-encryption-keys"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Providing Control Over Cache Encryption</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/keyboard-shortcuts"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Keyboard Shortcuts in BuildBuddy</div></a></nav></div></main><div class="col col--1"></div><div class="col col--3"><div class="blog-sidebar"><div class="sidebar_ycyQ thin-scrollbar"><h3 class="sidebarItemTitle_uR5j">Recent posts</h3><ul class="sidebarItemList_TpH3"><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/welcoming-dan-stowell">Welcoming Dan Stowell</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/unusual-builds-w-bytes">Unusual Builds with Bytes</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/bisect-bazel">Troubleshooting Bazel with Git Bisect</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/welcoming-vanja-pejovic">Welcoming Vanja Pejovic</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/welcoming-fabian-meumertzheim">Welcoming Fabian Meumertzheim</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/debugging-slow-bazel-builds">Why is my Bazel build so slow?</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/how-to-migrate-an-ios-app-to-bazel">How to migrate an iOS app to Bazel</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/how-bazel-7-0-makes-your-builds-faster">How Bazel 7.0 Makes Your Builds Faster</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/whats-new-in-bazel-7-0">What&#x27;s New in Bazel 7.0</a></li><li class="sidebarItem_WWBq"><a class="sidebarItemLink_Hhz8" href="/blog/image-streaming">Lazily Pulling Container Images with Podman and SOCI Snapshotter</a></li></ul></div></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="/"><img alt="BuildBuddy Logo" src="/img/logo_white.svg" width="281px" height="32px" class="footer-logo"></a></li></ul></div><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/ui">Build &amp; Test UI</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/remote-execution">Remote Execution</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/remote-cache">Remote Cache</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/workflows">Workflows</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/cli">CLI</a></li><li class="footer__item"><a href="https://app.buildbuddy.io" target="_self" rel="noopener noreferrer" class="footer__link-item">Get Started<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://app.buildbuddy.io/" target="_self" rel="noopener noreferrer" class="footer__link-item">Login<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/introduction/">Docs</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/pricing">Pricing</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/security">Security</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/plugins">Plugins</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/docs/enterprise-api">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" target="_self" href="/contact">Contact Us</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/team">Team</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/careers">Careers</a></li><li class="footer__item"><a href="https://github.com/buildbuddy-io/buildbuddy/issues/new" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report an Issue<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/privacy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" target="_self" href="/terms">Terms of Service</a></li></ul></div><div class="col footer__col"><div class="footer__title">Connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://community.buildbuddy.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/buildbuddy_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://linkedin.com/company/buildbuddy" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/buildbuddy-io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2025 Iteration, Inc.</div></div></div></footer></div>
</body>
</html>