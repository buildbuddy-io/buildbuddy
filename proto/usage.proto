syntax = "proto3";

package usage;

import "proto/context.proto";

message GetUsageRequest {
  // Request context.
  context.RequestContext request_context = 1;

  // The usage period to be fetched, as a UTC month in "YYYY-MM" format.
  // If empty, the current usage period will be returned.
  string usage_period = 2;
}

message GetUsageResponse {
  // Response context.
  context.ResponseContext response_context = 1;

  // Usage numbers for the requested UTC month.
  Usage usage = 2;

  // Daily usage numbers for the requested UTC month.
  repeated Usage daily_usage = 4;

  // The available usage periods that may be specified in a subsequent
  // GetUsageRequest.
  repeated string available_usage_periods = 3;
}

// Usage represents a count of BuildBuddy resources used for a particular time
// period.
message Usage {
  // Usage period in UTC, in "YYYY-MM" or "YYYY-MM-DD" format.
  string period = 1;

  // The number of invocations.
  int64 invocations = 2;

  // The number of action cache hits.
  int64 action_cache_hits = 3;

  // The number of content addressable store hits.
  int64 cas_cache_hits = 4;

  // The number of bytes downloaded.
  int64 total_download_size_bytes = 5;

  // The total execution duration for Linux executors, in microseconds.
  int64 linux_execution_duration_usec = 6;

  // The number of bytes uploaded.
  int64 total_upload_size_bytes = 7;

  // The sum of approximate time savings of builds based on
  // the sum of execution time of cached objects.
  int64 total_cached_action_exec_usec = 8;

  // The number of bytes downloaded from outside of BuildBuddy-owned servers.
  int64 total_external_download_size_bytes = 9;

  // The number of bytes downloaded from within BuildBuddy-owned servers,
  // excluding workflows.
  int64 total_internal_download_size_bytes = 10;

  // The number of bytes downloaded from BuildBuddy-owned workflow servers.
  int64 total_workflow_download_size_bytes = 11;

  // The number of bytes uploaded from outside of BuildBuddy-owned servers.
  int64 total_external_upload_size_bytes = 12;

  // The number of bytes uploaded from within BuildBuddy-owned servers,
  // excluding workflows.
  int64 total_internal_upload_size_bytes = 13;

  // The number of bytes uploaded from BuildBuddy-owned workflow servers.
  int64 total_workflow_upload_size_bytes = 14;

  // Total raw cpu time (2 cpus for 1 minutes = 2 minutes) used on
  // BuildBuddy-owned executors and workflow runners.  Idle time is uncounted.
  int64 cloud_cpu_nanos = 15;

  // Total raw cpu time (2 cpus for 1 minutes = 2 minutes) used on
  // BuildBuddy-owned executors.  Idle time is uncounted.
  int64 cloud_rbe_cpu_nanos = 16;

  // Total raw cpu time (2 cpus for 1 minutes = 2 minutes) used on
  // BuildBuddy-owned workflow runners.  Idle time is uncounted.
  int64 cloud_workflow_cpu_nanos = 17;

  // Total wall time of tasks run on BuildBuddy-owned executors, ignoring cpu
  // utilization.  Idle time is counted.
  int64 cloud_rbe_linux_execution_duration_usec = 18;

  // Total wall time of tasks run on BuildBuddy-owned workflow runners,
  // ignoring cpu utilization.  Idle time is counted.
  int64 cloud_workflow_linux_execution_duration_usec = 19;
}
