
syntax = "proto3";

package auth;

enum JWTSigningMethod {
  UNKNOWN = 0; // Defaults to HS256
  HS256 = 1;
  ES256 = 2;
}

// Most Authentication information (API key, source IP) is passed via headers.
message AuthenticateRequest {
  // The subdomain to which the request was sent.
  optional string subdomain = 1;

  // The signing method to use for the returned JWT.
  optional JWTSigningMethod jwt_signing_method = 2;
}

message AuthenticateResponse {
  // JWT that may be cached short-term for local authentication.
  optional string jwt = 1;
}

message GetPublicKeysRequest {}

message GetPublicKeysResponse {
  repeated PublicKey public_keys = 1;
}

message PublicKey {
  // The ES256 public key. For example:
  // -----BEGIN PUBLIC KEY-----
  // MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAERAO9/by7nWrH/SG49clP0r21DnuK
  // cmrxBLfEqQL12N+j/rxasGFNrgQsp76UkWk3iJqcLFg8YOUZ/fjCn4+epA==
  // -----END PUBLIC KEY-----
  //
  // More info JWTs, signing, and keys at http://jwt.io
  optional string key = 1;
}

service AuthService {
  rpc Authenticate(AuthenticateRequest) returns (AuthenticateResponse);
  rpc GetPublicKeys(GetPublicKeysRequest) returns (GetPublicKeysResponse);
}
