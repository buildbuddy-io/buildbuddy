"use strict";(self.webpackChunkbuildbuddy_docs_website=self.webpackChunkbuildbuddy_docs_website||[]).push([[305],{99966:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>u,frontMatter:()=>d,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"config-olap-database","title":"OLAP Database Configuration","description":"Introduction","source":"@site/../docs/config-olap-databases.md","sourceDirName":".","slug":"/config-olap-database","permalink":"/docs/config-olap-database","draft":false,"unlisted":false,"editUrl":"https://github.com/buildbuddy-io/buildbuddy/edit/master/docs/../docs/config-olap-databases.md","tags":[],"version":"current","lastUpdatedBy":"Lulu Zhang","lastUpdatedAt":1770228527000,"frontMatter":{"id":"config-olap-database","title":"OLAP Database Configuration","sidebar_label":"OLAP Database"},"sidebar":"someSidebar","previous":{"title":"Database","permalink":"/docs/config-database"},"next":{"title":"Storage","permalink":"/docs/config-storage"}}');var i=n(74848),s=n(28453);const d={id:"config-olap-database",title:"OLAP Database Configuration",sidebar_label:"OLAP Database"},r=void 0,o={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Options",id:"options",level:2},{value:"Example sections",id:"example-sections",level:2},{value:"Sizing",id:"sizing",level:2},{value:"Feature Configuration",id:"feature-configuration",level:2},{value:"Trends and Drilldown",id:"trends-and-drilldown",level:3},{value:"Test Grid",id:"test-grid",level:3},{value:"Audit Logging",id:"audit-logging",level:3},{value:"Remote Execution Data Storage",id:"remote-execution-data-storage",level:3}];function c(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(t.p,{children:"To speed up the analysis of historical build event data, BuildBuddy can be configured to use ClickHouse as an OLAP database, in addition to the primary SQL database required for core functionality."}),"\n",(0,i.jsx)(t.p,{children:"Setting up ClickHouse is completely optional when using BuildBuddy.\nBuildBuddy does not require ClickHouse for its core features, including the build results UI, remote cache, and remote execution system."}),"\n",(0,i.jsx)(t.p,{children:"However, some UI features, such as Trends, Drilldown, Test Grid, Tags filtering, and Audit Logging, may require ClickHouse.\nWithout a configured ClickHouse instance, these features will either be missing from the UI, or will be missing some features and may not scale to larger amounts of data."}),"\n",(0,i.jsx)(t.h2,{id:"options",children:"Options"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Optional"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"olap_database:"})," The OLAP (online analytical processing) database section configures the OLAP database that BuildBuddy uses to enable the Trends page. ",(0,i.jsx)(t.strong,{children:"Optional"})]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"data_source"})," This is a connection string used by the database driver to connect to the database. ClickHouse database is supported."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"enable_data_replication"})," If ClickHouse is using a ",(0,i.jsx)(t.a,{href:"https://clickhouse.com/docs/en/architecture/cluster-deployment",children:"cluster deployment"}),", this will enable data replication within the cluster."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"example-sections",children:"Example sections"}),"\n",(0,i.jsx)(t.p,{children:"Example single-instance ClickHouse configuration:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'olap_database:\n  data_source: "clickhouse://buildbuddy_user:pAsSwOrD@12.34.56.78:9000/buildbuddy_db"\n'})}),"\n",(0,i.jsx)(t.p,{children:"Example ClickHouse cluster configuration:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:'olap_database:\n  data_source: "clickhouse://buildbuddy_user:pAsSwOrD@12.34.56.78:9000/buildbuddy_db"\n  enable_data_replication: true\n'})}),"\n",(0,i.jsx)(t.h2,{id:"sizing",children:"Sizing"}),"\n",(0,i.jsx)(t.p,{children:"2 CPUs and 50 GiB memory can handle ~150 insert QPS (normal) / 600 QPS (peak).\nDisk usage can be estimated as follows:"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Table"}),(0,i.jsx)(t.th,{children:"avg_bytes_per_row"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Executions"}),(0,i.jsx)(t.td,{children:"260"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Invocations"}),(0,i.jsx)(t.td,{children:"107"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"TestTargetStatuses"}),(0,i.jsx)(t.td,{children:"23.0"})]})]})]}),"\n",(0,i.jsxs)(t.p,{children:["Note: ",(0,i.jsx)(t.code,{children:"TestTargetStatuses"})," corresponds to ",(0,i.jsx)(t.code,{children:"Targets"})," and ",(0,i.jsx)(t.code,{children:"TargetStatuses"})," in MySQL.\nAn additional 20% disk is recommended to be reserved to handle additional disk usage during merging."]}),"\n",(0,i.jsx)(t.h2,{id:"feature-configuration",children:"Feature Configuration"}),"\n",(0,i.jsx)(t.p,{children:"After configuring the ClickHouse connection, you'll need to enable specific feature flags to use the OLAP-powered UI features:"}),"\n",(0,i.jsx)(t.h3,{id:"trends-and-drilldown",children:"Trends and Drilldown"}),"\n",(0,i.jsxs)(t.p,{children:["The Trends page provides historical analysis of build performance and patterns. An example of how to use Trends and Drilldown can be found at ",(0,i.jsx)(t.a,{href:"https://www.buildbuddy.io/blog/debugging-slow-bazel-builds/#5-was-there-a-change-in-my-project-that-could-explain-increasing-build-times",children:"this blog post"}),".\nMost of the features are enabled by default once you set up the OLAP\ndatabase."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"app:\n  trends_summary_enabled: true # Show summary section at the top of trends UI (optional, default: false)\n"})}),"\n",(0,i.jsx)(t.h3,{id:"test-grid",children:"Test Grid"}),"\n",(0,i.jsx)(t.p,{children:"The Test Grid provides a comprehensive view of test results over time."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"app:\n  enable_target_tracking: true # Enable target tracking (default: false)\n  test_grid_v2_enabled: true # Enable Test Grid V2 (default: true)\n  enable_write_test_target_statuses_to_olap_db: true # Write test target statuses to ClickHouse (default: false)\n"})}),"\n",(0,i.jsx)(t.h3,{id:"audit-logging",children:"Audit Logging"}),"\n",(0,i.jsx)(t.p,{children:"Audit logs track administrative events and require ClickHouse for storage."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"app:\n  audit_logs_enabled: true # Log administrative events to audit log (default: false)\n  audit_logs_ui_enabled: true # Make audit logs accessible from the sidebar (default: false)\n"})}),"\n",(0,i.jsx)(t.h3,{id:"remote-execution-data-storage",children:"Remote Execution Data Storage"}),"\n",(0,i.jsx)(t.p,{children:"By default, BuildBuddy automatically writes remote execution data to ClickHouse when an OLAP database is configured. You can also enable reading execution data from ClickHouse instead of the primary database for better performance."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"app:\n  enable_write_executions_to_olap_db: true # Write execution data to ClickHouse (default: true)\n\nremote_execution:\n  olap_reads_enabled: true # Read executions from ClickHouse (and in-progress execution info from Redis) (default: false)\n  write_execution_progress_state_to_redis: true # Write execution progress updates to Redis (default: false)\n  write_executions_to_primary_db: false # Write executions to the primary DB (default: true)\n  primary_db_reads_enabled: false # Read executions from the primary database (default: true)\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Note:"})," ",(0,i.jsx)(t.code,{children:"write_execution_progress_state_to_redis: true"})," needs to be set in order for in-progress executions to show up in the UI."]}),"\n",(0,i.jsxs)(t.p,{children:["When ",(0,i.jsx)(t.code,{children:"olap_reads_enabled"})," and ",(0,i.jsx)(t.code,{children:"write_execution_progress_state_to_redis"})," are enabled, BuildBuddy will:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Read completed execution data from ClickHouse"}),"\n",(0,i.jsx)(t.li,{children:"Read in-progress execution information from Redis"}),"\n",(0,i.jsx)(t.li,{children:"Fall back to the primary database for executions not found in ClickHouse"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Migration considerations:"})," After migrating to ClickHouse, primary DB writes can be disabled (",(0,i.jsx)(t.code,{children:"write_executions_to_primary_db: false"}),"), so that executions are only written to Redis + ClickHouse, reducing load on the primary DB."]}),"\n",(0,i.jsxs)(t.p,{children:["It may also be desired to set ",(0,i.jsx)(t.code,{children:"primary_db_reads_enabled: false"})," to skip primary DB reads once primary DB writes are disabled. This will speed up queries for the executions page, but older invocations created before migrating to ClickHouse will not have any execution data displayed in the UI."]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>d,x:()=>r});var a=n(96540);const i={},s=a.createContext(i);function d(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);