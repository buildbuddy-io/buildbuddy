"use strict";(self.webpackChunkbuildbuddy_docs_website=self.webpackChunkbuildbuddy_docs_website||[]).push([[9645],{37804:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>o});var s=n(85893),d=n(11151);const r={id:"config-auth",title:"Auth Configuration",sidebar_label:"Auth"},l=void 0,t={id:"config-auth",title:"Auth Configuration",description:"Auth is only configurable in the Enterprise version of BuildBuddy.",source:"@site/../docs/config-auth.md",sourceDirName:".",slug:"/config-auth",permalink:"/docs/config-auth",draft:!1,unlisted:!1,editUrl:"https://github.com/buildbuddy-io/buildbuddy/edit/master/docs/../docs/config-auth.md",tags:[],version:"current",lastUpdatedBy:"Lulu Zhang",lastUpdatedAt:1702055153,formattedLastUpdatedAt:"Dec 8, 2023",frontMatter:{id:"config-auth",title:"Auth Configuration",sidebar_label:"Auth"},sidebar:"someSidebar",previous:{title:"SSL",permalink:"/docs/config-ssl"},next:{title:"Integrations",permalink:"/docs/config-integrations"}},c={},o=[{value:"OIDC",id:"oidc",level:2},{value:"Section",id:"section",level:3},{value:"Options",id:"options",level:3},{value:"Redirect URL",id:"redirect-url",level:3},{value:"OIDC Examples",id:"oidc-examples",level:3},{value:"Google auth provider",id:"google-auth-provider",level:4},{value:"Gitlab auth provider",id:"gitlab-auth-provider",level:4},{value:"Azure AD provider",id:"azure-ad-provider",level:4},{value:"SAML 2.0",id:"saml-20",level:2},{value:"Okta SAML provider",id:"okta-saml-provider",level:3},{value:"Azure AD / Entra SAML provider",id:"azure-ad--entra-saml-provider",level:3},{value:"Other providers",id:"other-providers",level:3}];function a(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.p,{children:["Auth is only configurable in the ",(0,s.jsx)(i.a,{href:"/docs/enterprise",children:"Enterprise version"})," of BuildBuddy."]}),"\n",(0,s.jsx)(i.h2,{id:"oidc",children:"OIDC"}),"\n",(0,s.jsx)(i.h3,{id:"section",children:"Section"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"auth:"})," The Auth section enables BuildBuddy authentication using an OpenID Connect provider that you specify. ",(0,s.jsx)(i.strong,{children:"Optional"})]}),"\n",(0,s.jsx)(i.h3,{id:"options",children:"Options"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"oauth_providers:"})," A list of configured OAuth Providers.","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"issuer_url: "})," The issuer URL of this OIDC Provider."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"client_id: "})," The oauth client ID."]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"client_secret: "})," The oauth client secret."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.code,{children:"enable_anonymous_usage:"})," If true, unauthenticated build uploads will still be allowed but won't be associated with your organization."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"redirect-url",children:"Redirect URL"}),"\n",(0,s.jsxs)(i.p,{children:["If during your OpenID provider configuration you're asked to enter a ",(0,s.jsx)(i.strong,{children:"Redirect URL"}),", you should enter ",(0,s.jsx)(i.code,{children:"https://YOUR_BUILDBUDDY_URL/auth/"}),". For example if your BuildBuddy instance was hosted on ",(0,s.jsx)(i.code,{children:"https://buildbuddy.acme.com"}),", you'd enter ",(0,s.jsx)(i.code,{children:"https://buildbuddy.acme.com/auth/"})," as your redirect url."]}),"\n",(0,s.jsx)(i.h3,{id:"oidc-examples",children:"OIDC Examples"}),"\n",(0,s.jsx)(i.h4,{id:"google-auth-provider",children:"Google auth provider"}),"\n",(0,s.jsxs)(i.p,{children:["If you'd like to use Google as an auth provider, you can easily obtain your client id and client secret ",(0,s.jsx)(i.a,{href:"https://console.developers.google.com/apis/credentials",children:"here"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Example"}),":"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'auth:\n  oauth_providers:\n    - issuer_url: "https://accounts.google.com"\n      client_id: "12345678911-f1r0phjnhbabcdefm32etnia21keeg31.apps.googleusercontent.com"\n      client_secret: "sEcRetKeYgOeShErE"\n'})}),"\n",(0,s.jsx)(i.h4,{id:"gitlab-auth-provider",children:"Gitlab auth provider"}),"\n",(0,s.jsx)(i.p,{children:"You can use Gitlab as an OIDC identity provider for BuildBuddy.\nThis feature is available for both Gitlab On-Prem Deployment and Gitlab SaaS offering."}),"\n",(0,s.jsxs)(i.p,{children:["For more details, please refer to ",(0,s.jsx)(i.a,{href:"https://docs.gitlab.com/ee/integration/openid_connect_provider.html",children:"Gitlab's latest Official Documentation"})]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Note"}),": Because ",(0,s.jsx)(i.a,{href:"https://gitlab.com/gitlab-org/gitlab/-/issues/16620",children:"Gitlab has yet to support refresh tokens"}),", you need to configure BuildBuddy to not request the ",(0,s.jsx)(i.code,{children:"offline_access"})," scope from Gitlab:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"auth:\n  disable_refresh_token: true\n"})}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["First, register a Gitlab Application:","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["For Gitlab SaaS, follow ",(0,s.jsx)(i.a,{href:"https://docs.gitlab.com/ee/integration/oauth_provider.html#create-a-group-owned-application",children:"Group-Owned Application Documentation"})," instructions."]}),"\n",(0,s.jsxs)(i.li,{children:["For Gitlab On-Prem, follow ",(0,s.jsx)(i.a,{href:"https://docs.gitlab.com/ee/integration/oauth_provider.html#create-a-group-owned-application",children:"Instance-Wide Application Documentation"})," instructions."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["The Redirect URL should be ",(0,s.jsx)(i.code,{children:"https://YOUR_BUILDBUDDY_URL/auth/"}),", pointing to your existing BuildBuddy deployment."]}),"\n",(0,s.jsxs)(i.li,{children:["The scopes needed are ",(0,s.jsx)(i.code,{children:"openid"}),", ",(0,s.jsx)(i.code,{children:"profile"})," and ",(0,s.jsx)(i.code,{children:"email"}),"."]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Once the Gitlab application is created, you can configure it as a BuildBuddy auth provider like so:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'auth:\n  oauth_providers:\n    - issuer_url: "https://gitlab.com"\n      client_id: "<GITLAB APPLICATION ID>"\n      client_secret: "<GITLAB APPLICATION SECRET>"\n'})}),"\n",(0,s.jsx)(i.h4,{id:"azure-ad-provider",children:"Azure AD provider"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Navigate to the ",(0,s.jsx)(i.a,{href:"https://portal.azure.com/",children:"Azure Portal"}),".\nIf there are multiple Azure AD tenants available, select the tenant that will be using BuildBuddy."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Register a BuildBuddy application:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Search for and select Azure Active Directory"}),"\n",(0,s.jsxs)(i.li,{children:["Under ",(0,s.jsx)(i.code,{children:"Manage"}),", select ",(0,s.jsx)(i.code,{children:"App registration"})," -> ",(0,s.jsx)(i.code,{children:"New registration"})]}),"\n",(0,s.jsxs)(i.li,{children:["Enter ",(0,s.jsx)(i.code,{children:"BuildBuddy"})," for application name."]}),"\n",(0,s.jsxs)(i.li,{children:["Select the account types in Azure AD that should have access to BuildBuddy.\nUsually ",(0,s.jsx)(i.code,{children:"Accounts in this organizational directory only"}),' is correct for the single-tenant use case,\n"Accounts in any organizational directory" is correct for the multi-tenant use case.']}),"\n",(0,s.jsxs)(i.li,{children:["Redirect URI should be ",(0,s.jsx)(i.code,{children:"https://YOUR_BUILDBUDDY_URL/auth/"})," with ",(0,s.jsx)(i.code,{children:"Web"})," platform."]}),"\n",(0,s.jsxs)(i.li,{children:["Click ",(0,s.jsx)(i.code,{children:"Register"})]}),"\n",(0,s.jsxs)(i.li,{children:["Take note of ",(0,s.jsx)(i.code,{children:"Application (client) ID"})," and ",(0,s.jsx)(i.code,{children:"Directory (tenant) ID"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Configure Application Secret"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Click on ",(0,s.jsx)(i.code,{children:"Certificates & secrets"})," -> ",(0,s.jsx)(i.code,{children:"Client secrets"})," -> ",(0,s.jsx)(i.code,{children:"New client secret"}),"\nWe recommend set the expiry date of the secret to 12 months."]}),"\n",(0,s.jsxs)(i.li,{children:["Click ",(0,s.jsx)(i.code,{children:"Add"})," -> Take note of the ",(0,s.jsx)(i.code,{children:"Value"})," of the newly created secret."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"Configure Application API scope"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Navigate to ",(0,s.jsx)(i.code,{children:"API permissions"})]}),"\n",(0,s.jsxs)(i.li,{children:["Select ",(0,s.jsx)(i.code,{children:"Add a permission"})," -> ",(0,s.jsx)(i.code,{children:"Microsoft Graph"})," -> ",(0,s.jsx)(i.code,{children:"Delegated permission"})]}),"\n",(0,s.jsxs)(i.li,{children:["In ",(0,s.jsx)(i.code,{children:"OpenId permissions"}),", select ",(0,s.jsx)(i.code,{children:"email"}),", ",(0,s.jsx)(i.code,{children:"offline_access"}),", ",(0,s.jsx)(i.code,{children:"openid"}),", ",(0,s.jsx)(i.code,{children:"profile"}),"."]}),"\n",(0,s.jsxs)(i.li,{children:["In ",(0,s.jsx)(i.code,{children:"User"}),", select ",(0,s.jsx)(i.code,{children:"User.Read"})]}),"\n",(0,s.jsxs)(i.li,{children:["Click ",(0,s.jsx)(i.code,{children:"Add permissions"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsx)(i.p,{children:"After that, your BuildBuddy config should be like this"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'auth:\n  oauth_providers:\n    - issuer_url: "https://login.microsoftonline.com/<DIRECTORY_ID>/v2.0"\n      client_id: "<CLIENT_ID>"\n      client_secret: "<CLIENT_SECRET>"\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"saml-20",children:"SAML 2.0"}),"\n",(0,s.jsx)(i.p,{children:"SAML 2.0 authentication is avaliable for BuildBuddy Cloud (SaaS)."}),"\n",(0,s.jsx)(i.h3,{id:"okta-saml-provider",children:"Okta SAML provider"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Find your organization's short name (slug) in your ",(0,s.jsx)(i.a,{href:"https://app.buildbuddy.io/settings/",children:"BuildBuddy Organization Settings"})," and replace instances of ",(0,s.jsx)(i.code,{children:"<org-slug>"})," below with this value."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["On the Okta Applications page, click ",(0,s.jsx)(i.code,{children:"Create App Integration"}),", select ",(0,s.jsx)(i.code,{children:"SAML 2.0"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Enter ",(0,s.jsx)(i.code,{children:"BuildBuddy"})," and hit ",(0,s.jsx)(i.code,{children:"Next"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Enter the following fields under ",(0,s.jsx)(i.strong,{children:"General"}),", making sure to replace ",(0,s.jsx)(i.code,{children:"<org-slug>"})," with the value froms step 1:"]}),"\n",(0,s.jsxs)(i.p,{children:["a. For Single sign on URL enter: ",(0,s.jsx)(i.code,{children:"https://app.buildbuddy.io/auth/saml/acs?slug=<org-slug>"})]}),"\n",(0,s.jsxs)(i.p,{children:["b. For Audience URI (SP Entity ID) enter: ",(0,s.jsx)(i.code,{children:"https://app.buildbuddy.io/saml/metadata?slug=<org-slug>"})]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Add an ",(0,s.jsx)(i.code,{children:"Attribute Statement"})," to map ",(0,s.jsx)(i.code,{children:"email"})," and value ",(0,s.jsx)(i.code,{children:"user.email"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click ",(0,s.jsx)(i.code,{children:"Finish"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Under ",(0,s.jsx)(i.code,{children:"Metadata URL"})," click copy and share this URL (which should have the format ",(0,s.jsx)(i.code,{children:"https://xxxx.okta.com/app/XXXX/sso/saml/metadata"}),") with BuildBuddy support."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"azure-ad--entra-saml-provider",children:"Azure AD / Entra SAML provider"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Find your organization's short name (slug) in your ",(0,s.jsx)(i.a,{href:"https://app.buildbuddy.io/settings/",children:"BuildBuddy Organization Settings"})," and replace instances of ",(0,s.jsx)(i.code,{children:"<org-slug>"})," below with this value."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Visit the ",(0,s.jsx)(i.a,{href:"https://entra.microsoft.com/",children:"Entra portal page"}),", navigate to ",(0,s.jsx)(i.code,{children:"Applications"})," -> ",(0,s.jsx)(i.code,{children:"Enterprise applications"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click ",(0,s.jsx)(i.code,{children:"New application"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Search for ",(0,s.jsx)(i.code,{children:"Azure AD SAML Toolkit"})," and select it. Change the name to ",(0,s.jsx)(i.code,{children:"BuildBuddy"})," and hit ",(0,s.jsx)(i.code,{children:"Create"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["In the newly created appliction view, navigate to ",(0,s.jsx)(i.code,{children:"Single sign-on"})," and select ",(0,s.jsx)(i.code,{children:"SAML"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click on ",(0,s.jsx)(i.code,{children:"Edit"})," in the first section ",(0,s.jsx)(i.code,{children:"Basic SAML Configuration"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["a. ",(0,s.jsx)(i.code,{children:"Identified (Entity ID)"})," should be ",(0,s.jsx)(i.code,{children:"https://app.buildbuddy.io/saml/metadata?slug=<org-slug>"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["b. ",(0,s.jsx)(i.code,{children:"Reply URL (Assertion Consumer Service URL)"})," should be ",(0,s.jsx)(i.code,{children:"https://app.buildbuddy.io/auth/saml/acs?slug=<org-slug>"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["c. ",(0,s.jsx)(i.code,{children:"Sign on URL"})," should be ",(0,s.jsx)(i.code,{children:"https://app.buildbuddy.io/login?slug=<org-slug>"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["d. Hit ",(0,s.jsx)(i.code,{children:"Save"})," button."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Click on ",(0,s.jsx)(i.code,{children:"Edit"})," in the second section ",(0,s.jsx)(i.code,{children:"Attributes & Claims"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["a. Select ",(0,s.jsx)(i.code,{children:"Add new claim"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["b. For ",(0,s.jsx)(i.code,{children:"Name"}),", fill in ",(0,s.jsx)(i.code,{children:"email"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["c. For ",(0,s.jsx)(i.code,{children:"Source"})," select ",(0,s.jsx)(i.code,{children:"Attribute"})," and for ",(0,s.jsx)(i.code,{children:"Source attribute"}),", search and select ",(0,s.jsx)(i.code,{children:"user.mail"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["d. Hit the ",(0,s.jsx)(i.code,{children:"Save"})," button."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["In the 3rd section ",(0,s.jsx)(i.code,{children:"SAML Certificates"}),", copy the ",(0,s.jsx)(i.code,{children:"App Federation Metadata Url"})," and share it with BuildBuddy support."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"other-providers",children:"Other providers"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Find the short name (slug) for your organization in your ",(0,s.jsx)(i.a,{href:"https://app.buildbuddy.io/settings/",children:"BuildBuddy Organization Settings"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Assertion Consumer Service (ACS) URL"}),": ",(0,s.jsx)(i.code,{children:"https://app.buildbuddy.io/auth/saml/acs?slug=<org-slug>"})]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Audience URL (SP Entity ID)"}),": ",(0,s.jsx)(i.code,{children:"https://app.buildbuddy.io/saml/metadata?slug=<org-slug>"})]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:["\n",(0,s.jsxs)(i.p,{children:["Make sure the ",(0,s.jsx)(i.code,{children:"email"})," attribute is mapped to ",(0,s.jsx)(i.code,{children:"user.email"})," (or equivalent)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:["Once the app is created, share the ",(0,s.jsx)(i.strong,{children:"Identity Provider Metadata"})," URL with BuildBuddy support."]})]})}function h(e={}){const{wrapper:i}={...(0,d.a)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>t,a:()=>l});var s=n(67294);const d={},r=s.createContext(d);function l(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function t(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);